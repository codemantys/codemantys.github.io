<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silran Coin • S-CHAIN Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        :root {
            --bg-color: #0d0d12;
            --card-bg: #1a1a22;
            --accent-purple: #7b3fe4;
            --accent-blue: #00a2ff;
            --text-main: #ffffff;
            --text-dim: #94a3b8;
            --green-glow: #10b981;
            --red-glow: #ef4444;
            --yellow-glow: #f59e0b;
            --telegram-blue: #0088cc;
            --block-border: #2a2a35;
            --block-highlight: rgba(123, 63, 228, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        /* --- User Agreement Overlay --- */
        .user-agreement-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 9999;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }

        .agreement-container {
            padding: 30px 20px;
            max-width: 800px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .agreement-header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .agreement-logo {
            width: 80px;
            height: 80px;
            background: var(--accent-purple);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 36px;
            color: white;
        }

        .agreement-title {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 10px;
        }

        .agreement-subtitle {
            font-size: 14px;
            color: var(--text-dim);
        }

        .agreement-content {
            flex: 1;
            overflow-y: auto;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #252530;
            line-height: 1.6;
        }

        .agreement-section {
            margin-bottom: 30px;
        }

        .agreement-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-purple);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(123, 63, 228, 0.3);
        }

        .section-content {
            color: var(--text-dim);
            font-size: 14px;
            text-align: justify;
        }

        .section-content p {
            margin-bottom: 15px;
        }

        .section-content ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .section-content li {
            margin-bottom: 8px;
            position: relative;
        }

        .section-content li:before {
            content: "•";
            color: var(--accent-purple);
            font-weight: bold;
            margin-right: 10px;
        }

        .risk-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .risk-warning .section-title {
            color: var(--yellow-glow);
        }

        .important-note {
            background: rgba(123, 63, 228, 0.1);
            border: 1px solid rgba(123, 63, 228, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .agreement-footer {
            padding: 20px 0;
            border-top: 1px solid #252530;
            position: sticky;
            bottom: 0;
            background: var(--bg-color);
        }

        .agreement-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            user-select: none;
        }

        .agreement-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--accent-purple);
            cursor: pointer;
        }

        .agreement-checkbox label {
            color: var(--text-dim);
            font-size: 14px;
            cursor: pointer;
        }

        .agreement-checkbox label a {
            color: var(--accent-purple);
            text-decoration: underline;
        }

        .agree-button {
            width: 100%;
            padding: 16px;
            background: var(--accent-purple);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .agree-button:hover {
            background: #6a2fd1;
            transform: translateY(-2px);
        }

        .agree-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .agreement-scroll-indicator {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--text-dim);
            font-size: 12px;
            text-align: center;
            animation: bounce 2s infinite;
            display: none;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }

        /* --- Header --- */
        header {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .search-container {
            flex-grow: 1;
            background: #1e1e26;
            border-radius: 20px;
            display: flex;
            align-items: center;
            padding: 8px 15px;
            position: relative;
            transition: all 0.3s ease;
        }

        .search-container:focus-within {
            background: #252530;
            box-shadow: 0 0 0 2px var(--accent-purple);
        }

        .search-container input {
            background: transparent;
            border: none;
            color: white;
            margin-left: 10px;
            outline: none;
            width: 100%;
            font-size: 14px;
        }

        .search-container input::placeholder {
            color: var(--text-dim);
            opacity: 0.7;
        }

        .search-icon {
            color: #64748b;
            font-size: 14px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .search-icon:hover {
            color: var(--accent-purple);
        }

        .clear-search {
            display: none;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 14px;
            margin-left: 8px;
        }

        .clear-search:hover {
            color: var(--red-glow);
        }

        .header-icons {
            display: flex;
            gap: 18px;
            font-size: 18px;
            color: var(--text-dim);
        }

        .header-icons i {
            cursor: pointer;
            transition: color 0.3s;
        }

        .header-icons i:hover {
            color: var(--accent-purple);
        }

        /* --- Search Results View --- */
        .search-results-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .search-header {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--card-bg);
            border-bottom: 1px solid #252530;
        }

        .search-header .search-container {
            flex-grow: 1;
            margin: 0;
        }

        .close-search {
            color: var(--text-dim);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-search:hover {
            color: var(--accent-purple);
            background: rgba(123, 63, 228, 0.1);
        }

        .results-container {
            flex: 1;
            display: flex;
        }

        .results-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .quick-search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-radius: 0 0 12px 12px;
            border: 1px solid #252530;
            border-top: none;
            margin-top: 5px;
            display: none;
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
        }

        .quick-search-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #252530;
        }

        .quick-search-item:last-child {
            border-bottom: none;
        }

        .quick-search-item:hover {
            background: rgba(123, 63, 228, 0.1);
        }

        .quick-search-icon {
            color: var(--text-dim);
            font-size: 14px;
        }

        .quick-search-text {
            font-size: 14px;
            color: var(--text-main);
        }

        .search-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 13, 18, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            flex-direction: column;
            gap: 20px;
        }

        .search-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(123, 63, 228, 0.3);
            border-top: 3px solid var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Hero Section --- */
        .hero {
            padding: 10px 20px;
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .coin-tag {
            background: rgba(123, 63, 228, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            color: var(--accent-purple);
            font-weight: bold;
            border: 1px solid rgba(123, 63, 228, 0.3);
        }

        .balance-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .balance-amount {
            font-size: 32px;
            font-weight: 700;
        }

        .receive-btn {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .receive-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(123, 63, 228, 0.4);
        }

        .receive-btn i {
            font-size: 14px;
        }

        /* --- Quick Actions Scroll --- */
        .quick-actions {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            overflow-x: auto;
        }

        .action-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 75px;
            cursor: pointer;
        }

        .icon-circle {
            width: 50px;
            height: 50px;
            background: #1e1e26;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            color: var(--accent-purple);
            border: 1px solid #2a2a35;
            transition: 0.3s;
        }

        .action-item:hover .icon-circle {
            background: var(--accent-purple);
            color: white;
        }

        .action-item span {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* --- Featured Banner --- */
        .banner {
            margin: 0 15px 25px;
            background: linear-gradient(135deg, #1e1e26 0%, #0d0d12 100%);
            border-radius: 15px;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #2a2a35;
            position: relative;
            overflow: hidden;
        }

        .banner-content h3 { 
            font-size: 16px; 
            margin-bottom: 5px; 
            color: var(--accent-purple);
        }
        .banner-content p { 
            font-size: 12px; 
            color: var(--text-dim); 
            line-height: 1.5;
        }

        .banner-icon {
            font-size: 40px;
            color: var(--accent-purple);
            opacity: 0.8;
        }

        /* --- Sections --- */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 15px;
            font-size: 16px;
            font-weight: 600;
        }

        .see-all {
            font-size: 12px;
            color: var(--accent-purple);
            cursor: pointer;
        }

        .card-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 0 15px 25px;
        }

        .data-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #252530;
            transition: all 0.3s;
        }

        .data-card:hover {
            border-color: var(--accent-purple);
            transform: translateY(-2px);
        }

        .card-top { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            margin-bottom: 8px; 
        }
        .card-title { 
            font-size: 13px; 
            font-weight: bold; 
            color: var(--text-dim);
        }
        .card-val { 
            font-size: 15px; 
            font-weight: 600; 
            margin-bottom: 4px; 
        }
        .card-change { 
            font-size: 11px; 
            font-weight: 600;
        }

        .positive {
            color: var(--green-glow);
        }

        .negative {
            color: var(--red-glow);
        }

        /* --- Price Change Indicator --- */
        .price-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            margin-top: 2px;
        }

        .price-change i {
            font-size: 10px;
        }

        /* --- Ecosystem Reserve --- */
        .ecosystem-reserve {
            padding: 0 20px;
            margin-bottom: 25px;
        }

        .reserve-list {
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid #252530;
            overflow: hidden;
        }

        .reserve-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #1a1a22;
            transition: background 0.3s;
        }

        .reserve-item:hover {
            background: rgba(123, 63, 228, 0.05);
        }

        .reserve-item:last-child {
            border-bottom: none;
        }

        .reserve-left { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }
        .reserve-icon { 
            width: 38px; 
            height: 38px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px; 
            background: rgba(123, 63, 228, 0.1);
            color: var(--accent-purple);
            border: 1px solid rgba(123, 63, 228, 0.3);
        }

        .reserve-icon.fiat {
            background: rgba(16, 185, 129, 0.1);
            color: var(--green-glow);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .reserve-icon.usdc {
            background: rgba(39, 117, 202, 0.1);
            color: #2775ca;
            border-color: rgba(39, 117, 202, 0.3);
        }

        .reserve-icon.btc {
            background: rgba(247, 147, 26, 0.1);
            color: #f7931a;
            border-color: rgba(247, 147, 26, 0.3);
        }

        .reserve-icon.eth {
            background: rgba(98, 126, 234, 0.1);
            color: #627eea;
            border-color: rgba(98, 126, 234, 0.3);
        }

        .reserve-icon.xrp {
            background: rgba(0, 170, 228, 0.1);
            color: #00aae4;
            border-color: rgba(0, 170, 228, 0.3);
        }

        .reserve-icon.sol {
            background: rgba(0, 255, 163, 0.1);
            color: #00ffa3;
            border-color: rgba(0, 255, 163, 0.3);
        }

        .reserve-icon.avax {
            background: rgba(232, 65, 66, 0.1);
            color: #e84142;
            border-color: rgba(232, 65, 66, 0.3);
        }

        .reserve-details h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .reserve-details p {
            font-size: 11px;
            color: var(--text-dim);
        }

        .reserve-value {
            text-align: right;
        }

        .reserve-value h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .reserve-value p {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* --- Bottom Nav --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #0d0d12;
            display: flex;
            justify-content: space-around;
            padding: 12px 0 25px;
            border-top: 1px solid #1e1e26;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: var(--text-dim);
            font-size: 10px;
            text-decoration: none;
            transition: 0.2s;
            width: 20%;
            cursor: pointer;
        }

        .nav-item.active { color: var(--accent-purple); }
        .nav-icon { font-size: 20px; }

        /* --- Security Setup Floating Button --- */
        .security-setup-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: var(--accent-purple);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--text-main);
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 20px rgba(123, 63, 228, 0.4);
            border: 2px solid rgba(123, 63, 228, 0.3);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .security-setup-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(123, 63, 228, 0.6);
        }

        .security-setup-btn.set {
            background: var(--green-glow);
            border-color: rgba(16, 185, 129, 0.3);
            animation: none;
        }

        .security-setup-btn.set:hover {
            box-shadow: 0 6px 25px rgba(16, 185, 129, 0.6);
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 4px 20px rgba(123, 63, 228, 0.4);
            }
            50% {
                box-shadow: 0 4px 25px rgba(123, 63, 228, 0.7);
            }
            100% {
                box-shadow: 0 4px 20px rgba(123, 63, 228, 0.4);
            }
        }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #252530;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-purple);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-title i {
            font-size: 18px;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #2a2a35;
            color: var(--text-main);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
        }

        /* --- S-CHAIN Explorer Styles --- */
        .schain-date-range {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .schain-date-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #2a2a35;
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-main);
            font-size: 14px;
        }

        .schain-search-btn {
            background: var(--accent-purple);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .schain-search-btn:hover {
            background: #6a2fd1;
        }

        .block-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .block-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--block-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
            position: relative;
        }

        .block-card:hover {
            border-color: var(--accent-purple);
            background: var(--block-highlight);
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px dashed var(--block-border);
        }

        .block-number {
            font-weight: 700;
            color: var(--accent-purple);
            font-size: 16px;
        }

        .block-status {
            color: var(--green-glow);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .block-detail {
            display: flex;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .block-label {
            width: 100px;
            color: var(--text-dim);
        }

        .block-value {
            color: var(--text-main);
            font-weight: 500;
        }

        .block-txid {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-dim);
        }

        .no-results i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* --- Send Modal Loading States --- */
        .send-button {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .send-button.loading {
            background: var(--accent-purple);
            opacity: 0.8;
            cursor: not-allowed;
        }

        .send-button.success {
            background: var(--green-glow);
        }

        .send-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .send-check {
            color: white;
            font-size: 18px;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* --- P2P Modal Styles --- */
        .p2p-container {
            padding: 16px 0;
        }

        .p2p-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .p2p-icon-wrapper {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, rgba(123, 63, 228, 0.2) 0%, rgba(0, 162, 255, 0.2) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            border: 2px solid var(--accent-purple);
        }

        .p2p-icon-wrapper i {
            font-size: 36px;
            color: var(--accent-purple);
        }

        .p2p-title {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .p2p-subtitle {
            color: var(--text-dim);
            font-size: 14px;
            margin-bottom: 24px;
        }

        .p2p-features {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 28px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid #2a2a35;
            border-radius: 12px;
            padding: 16px 12px;
            text-align: center;
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: var(--accent-purple);
            transform: translateY(-2px);
        }

        .feature-icon {
            font-size: 24px;
            color: var(--accent-purple);
            margin-bottom: 8px;
        }

        .feature-text {
            font-size: 12px;
            color: var(--text-dim);
            line-height: 1.5;
        }

        .feature-text strong {
            color: var(--text-main);
            display: block;
            margin-bottom: 4px;
        }

        .p2p-community {
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.1) 0%, rgba(123, 63, 228, 0.1) 100%);
            border: 1px solid rgba(0, 136, 204, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .p2p-community p {
            color: var(--text-dim);
            font-size: 13px;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .telegram-btn {
            width: 100%;
            padding: 14px;
            background: var(--telegram-blue);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            margin-bottom: 12px;
            text-decoration: none;
        }

        .telegram-btn:hover {
            background: #0077b5;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
        }

        .telegram-btn i {
            font-size: 18px;
        }

        .telegram-btn.secondary {
            background: rgba(0, 136, 204, 0.2);
            color: var(--telegram-blue);
            border: 1px solid var(--telegram-blue);
        }

        .telegram-btn.secondary:hover {
            background: rgba(0, 136, 204, 0.3);
            color: white;
        }

        .p2p-footer {
            text-align: center;
            color: var(--text-dim);
            font-size: 12px;
            margin-top: 16px;
        }

        .p2p-footer i {
            color: var(--accent-purple);
            margin: 0 2px;
        }

        /* --- Form Elements --- */
        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--text-dim);
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #2a2a35;
            border-radius: 12px;
            color: var(--text-main);
            font-size: 14px;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-primary {
            background: var(--accent-purple);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #6a2fd1;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* --- Info Cards --- */
        .info-card {
            background: rgba(123, 63, 228, 0.1);
            border: 1px solid rgba(123, 63, 228, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .info-card i {
            color: var(--accent-purple);
            font-size: 18px;
        }

        .warning-card {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .warning-card i {
            color: var(--yellow-glow);
        }

        .success-card {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .success-card i {
            color: var(--green-glow);
        }

        /* --- Fee Display --- */
        .fee-display {
            background: rgba(123, 63, 228, 0.05);
            border: 1px solid rgba(123, 63, 228, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .fee-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 14px;
        }

        /* --- Login Page --- */
        .login-container {
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            display: none;
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: var(--accent-purple);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 36px;
            color: white;
        }

        .login-title {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 10px;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-dim);
        }

        .create-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #2a2a35;
        }

        .toggle-create-btn {
            width: 100%;
            padding: 14px;
            background: var(--card-bg);
            border: 1px solid #2a2a35;
            border-radius: 12px;
            color: var(--text-main);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .toggle-create-btn:hover {
            border-color: var(--accent-purple);
            background: rgba(123, 63, 228, 0.1);
        }

        .create-form {
            margin-top: 20px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid #2a2a35;
        }

        /* --- Forgot Password Button --- */
        .forgot-password-btn {
            width: 100%;
            padding: 14px;
            background: rgba(123, 63, 228, 0.1);
            border: 1px solid rgba(123, 63, 228, 0.3);
            border-radius: 12px;
            color: var(--accent-purple);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .forgot-password-btn:hover {
            background: rgba(123, 63, 228, 0.2);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
        }

        /* --- Profile Modal --- */
        .profile-info {
            padding: 20px 0;
        }

        .profile-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #2a2a35;
        }

        .profile-item:last-child {
            border-bottom: none;
        }

        .profile-label {
            color: var(--text-dim);
            font-size: 14px;
        }

        .profile-value {
            font-weight: 600;
            font-size: 16px;
        }

        /* --- Password Reveal Card --- */
        .password-reveal-card {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--green-glow);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
            text-align: center;
        }

        .password-display {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-main);
            letter-spacing: 4px;
            margin: 20px 0;
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 2px solid var(--green-glow);
            user-select: all;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .password-display:hover {
            background: rgba(16, 185, 129, 0.1);
            transform: scale(1.02);
        }

        .copy-instruction {
            color: var(--text-dim);
            font-size: 14px;
            margin-top: 12px;
        }

        .copy-btn {
            margin-top: 16px;
            background: var(--green-glow);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #0da271;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        /* --- Notification System --- */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .notification {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid #2a2a35;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            max-width: 100%;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-icon {
            font-size: 20px;
            margin-top: 2px;
        }

        .notification.success {
            border-left: 4px solid var(--green-glow);
        }

        .notification.success .notification-icon {
            color: var(--green-glow);
        }

        .notification.error {
            border-left: 4px solid var(--red-glow);
        }

        .notification.error .notification-icon {
            color: var(--red-glow);
        }

        .notification.info {
            border-left: 4px solid var(--accent-purple);
        }

        .notification.info .notification-icon {
            color: var(--accent-purple);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 13px;
            color: var(--text-dim);
            line-height: 1.4;
        }

        /* --- Loading Spinner --- */
        .loading-spinner {
            border: 3px solid rgba(123, 63, 228, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--accent-purple);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Flatpickr for calendar -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Security Setup Floating Button -->
    <div class="security-setup-btn" id="securitySetupBtn" onclick="showSecuritySetupModal()">
        <i class="fas fa-lock"></i>
    </div>

    <!-- User Agreement Overlay -->
    <div class="user-agreement-overlay" id="userAgreementOverlay">
        <div class="agreement-container">
            <div class="agreement-header">
                <div class="agreement-logo">
                    <i class="fas fa-wallet"></i>
                </div>
                <h1 class="agreement-title">Silran Coin</h1>
                <p class="agreement-subtitle">User Agreement & Privacy Policy</p>
            </div>

            <div class="agreement-content" id="agreementContent">
                <!-- Section 1: What is Silran Coin? -->
                <div class="agreement-section">
                    <h2 class="section-title">What is Silran Coin?</h2>
                    <div class="section-content">
                        <p>Silran Coin is a digital currency designed to represent real-world value in digital form. It is built to support transactions and value exchange between physical and digital economic systems. Silran Coin is not government-issued money and does not operate as a banking institution.</p>
                    </div>
                </div>

                <!-- Section 2: Key Risk Awareness -->
                <div class="agreement-section risk-warning">
                    <h2 class="section-title">Key Risk Awareness</h2>
                    <div class="section-content">
                        <p>Silran Coin operates as a digital asset, and digital systems inherently involve risks.</p>
                        <ul>
                            <li>Wallets are linked to user accounts and devices.</li>
                            <li>Deleting the application, changing devices, or failing to complete required updates or migrations may result in loss of wallet access.</li>
                            <li>Lost wallets cannot always be recovered.</li>
                            <li>Users are responsible for maintaining access credentials and backups.</li>
                        </ul>
                    </div>
                </div>

                <!-- Section 3: App Updates and Wallet Migration -->
                <div class="agreement-section">
                    <h2 class="section-title">App Updates and Wallet Migration</h2>
                    <div class="section-content">
                        <p>To maintain security, improve performance, and introduce new features, application updates and wallet migrations may be required periodically.</p>
                        <ul>
                            <li>Users who follow migration or update instructions correctly will retain access to their coins.</li>
                            <li>Users who fail to complete required updates or migrations risk losing wallet access.</li>
                            <li>Migration notices will always be communicated through official channels before implementation.</li>
                        </ul>
                    </div>
                </div>

                <!-- Section 4: Data Collection and Privacy -->
                <div class="agreement-section">
                    <h2 class="section-title">Data Collection and Privacy</h2>
                    <div class="section-content">
                        <p>Silran Coin collects limited user data strictly for functionality and service improvement. Collected data may include:</p>
                        <ul>
                            <li>Name</li>
                            <li>Email address</li>
                            <li>Profile picture</li>
                        </ul>
                        <p>User data is not sold or shared with third-party companies for marketing purposes. Media content such as uploaded images or videos is stored only to allow users to access their content within the platform.</p>
                    </div>
                </div>

                <!-- Section 5: Advertising and Tracking -->
                <div class="agreement-section">
                    <h2 class="section-title">Advertising and Tracking</h2>
                    <div class="section-content">
                        <p>Silran Coin may display advertisements to support platform operations. Advertising partners may collect anonymous technical data such as:</p>
                        <ul>
                            <li>Device type</li>
                            <li>Advertising ID</li>
                            <li>Interaction analytics</li>
                        </ul>
                        <p>No personally identifiable information is shared with advertisers.</p>
                    </div>
                </div>

                <!-- Section 6: No Investment or Profit Guarantee -->
                <div class="agreement-section important-note">
                    <h2 class="section-title">No Investment or Profit Guarantee</h2>
                    <div class="section-content">
                        <p>Silran Coin is not financial or investment advice. Ownership or use of Silran Coin does not guarantee profit or financial return. Users should participate in the ecosystem only after understanding the potential risks associated with digital assets.</p>
                    </div>
                </div>

                <!-- Section 7: User Responsibility Agreement -->
                <div class="agreement-section">
                    <h2 class="section-title">User Responsibility Agreement</h2>
                    <div class="section-content">
                        <p>By using Silran Coin, users acknowledge and agree to the following:</p>
                        <ul>
                            <li>Users are responsible for protecting their accounts and wallet credentials.</li>
                            <li>Users must follow official update and migration instructions.</li>
                            <li>Digital assets can be lost if proper security and backup procedures are not followed.</li>
                        </ul>
                        <p>Silran Coin aims to continuously improve system reliability, user protection mechanisms, and platform security standards.</p>
                    </div>
                </div>

                <!-- Section 8: Conclusion -->
                <div class="agreement-section">
                    <h2 class="section-title">Conclusion</h2>
                    <div class="section-content">
                        <p>Silran Coin represents an effort to unify real-world and digital economic value through a single ecosystem. The platform is committed to transparency, responsible system management, and long-term sustainability.</p>
                        <p>Users are encouraged to stay informed through official communication channels and follow recommended security practices to ensure safe participation in the Silran Coin currency ecosystem.</p>
                    </div>
                </div>
            </div>

            <!-- Scroll Indicator -->
            <div class="agreement-scroll-indicator" id="scrollIndicator">
                <i class="fas fa-chevron-down"></i><br>
                Scroll to continue
            </div>

            <!-- Agreement Footer -->
            <div class="agreement-footer">
                <div class="agreement-checkbox">
                    <input type="checkbox" id="agreeCheckbox" onchange="updateAgreeButton()">
                    <label for="agreeCheckbox">
                        I have read, understood, and agree to the User Agreement and Privacy Policy. 
                        I acknowledge the risks associated with digital assets.
                    </label>
                </div>
                <button class="agree-button" id="agreeButton" onclick="acceptAgreement()" disabled>
                    <i class="fas fa-check-circle"></i> Agree & Continue
                </button>
            </div>
        </div>
    </div>

    <!-- Search Results View -->
    <div class="search-results-view" id="searchResultsView">
        <div class="search-header">
            <div class="search-container">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                <input type="text" id="resultsSearch" class="search-input" placeholder="Search Google...">
                <span class="clear-search" onclick="clearSearch()">×</span>
            </div>
            <div class="close-search" onclick="closeSearchView()">
                <i class="fa-solid fa-times"></i>
            </div>
        </div>
        <div class="results-container">
            <iframe id="resultsFrame" class="results-frame" frameborder="0"></iframe>
        </div>
    </div>

    <!-- Search Loading Overlay -->
    <div class="search-loading" id="searchLoading">
        <div class="search-spinner"></div>
        <div style="color: var(--text-dim); font-size: 14px;">Searching on Google...</div>
    </div>

    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-header">
            <div class="login-logo">
                <i class="fas fa-wallet"></i>
            </div>
            <h1 class="login-title">Silran Coin</h1>
            <p class="login-subtitle">Secure Digital Wallet</p>
        </div>

        <div class="input-group">
            <label class="input-label">Wallet ID</label>
            <input type="text" id="appID" class="input-field" placeholder="Enter 4-digit Wallet ID" maxlength="4" oninput="validateLoginInputs()">
        </div>

        <div class="input-group">
            <label class="input-label">Password</label>
            <input type="password" id="password" class="input-field" placeholder="Enter 4-digit Password" maxlength="4" oninput="validateLoginInputs()">
        </div>

        <button id="loginButton" class="btn btn-primary" onclick="login()" disabled>
            <i class="fas fa-unlock"></i> Login to Wallet
        </button>

        <!-- Forgot Password Button -->
        <button id="forgotPasswordBtn" class="forgot-password-btn" onclick="showForgotPasswordFlow()" style="display: none;">
            <i class="fas fa-key"></i> Forgot Password?
        </button>

        <div class="create-section">
            <button class="toggle-create-btn" onclick="toggleCreateForm()">
                <i class="fas fa-plus-circle"></i> Create New Wallet
            </button>

            <div id="createForm" class="create-form" style="display: none;">
                <div class="input-group">
                    <label class="input-label">New Wallet ID</label>
                    <input type="text" id="newAppID" class="input-field" placeholder="Create 4-digit Wallet ID" maxlength="4" oninput="validateCreateInputs()">
                </div>

                <div class="input-group">
                    <label class="input-label">New Password</label>
                    <input type="password" id="newPassword" class="input-field" placeholder="Create 4-digit Password" maxlength="4" oninput="validateCreateInputs()">
                </div>

                <div class="input-group">
                    <label class="input-label">Confirm Password</label>
                    <input type="password" id="confirmPassword" class="input-field" placeholder="Confirm 4-digit Password" maxlength="4" oninput="validateCreateInputs()">
                </div>

                <button id="createWalletButton" class="btn btn-primary" onclick="createWallet()" disabled>
                    <i class="fas fa-check-circle"></i> Create Wallet
                </button>
            </div>
        </div>
    </div>

    <!-- Main Wallet Page -->
    <div id="walletPage" style="display: none;">
        <header>
            <div class="search-container" id="mainSearchContainer">
                <i class="fa-solid fa-magnifying-glass search-icon" onclick="focusSearch()"></i>
                <input type="text" id="mainSearch" placeholder="Search anything on Google..." onfocus="showSearchSuggestions()" onblur="hideSearchSuggestions()">
                <span class="clear-search" onclick="clearMainSearch()">×</span>
            </div>
            <div class="header-icons">
                <i class="fa-brands fa-x-twitter" onclick="openTwitter()"></i>
                <i class="fa-solid fa-user" onclick="showProfile()"></i>
            </div>
        </header>

        <!-- Quick Search Suggestions -->
        <div class="quick-search-suggestions" id="searchSuggestions">
            <div class="quick-search-item" onclick="quickSearch('Crypto market today')">
                <i class="fas fa-chart-line quick-search-icon"></i>
                <span class="quick-search-text">Crypto market today</span>
            </div>
            <div class="quick-search-item" onclick="quickSearch('Silran Coin price')">
                <i class="fas fa-coins quick-search-icon"></i>
                <span class="quick-search-text">Silran Coin price</span>
            </div>
            <div class="quick-search-item" onclick="quickSearch('Bitcoin news')">
                <i class="fab fa-bitcoin quick-search-icon"></i>
                <span class="quick-search-text">Bitcoin news</span>
            </div>
            <div class="quick-search-item" onclick="quickSearch('Wallet security tips')">
                <i class="fas fa-shield-alt quick-search-icon"></i>
                <span class="quick-search-text">Wallet security tips</span>
            </div>
            <div class="quick-search-item" onclick="quickSearch('NGN to USD rate')">
                <i class="fas fa-money-bill-wave quick-search-icon"></i>
                <span class="quick-search-text">NGN to USD rate</span>
            </div>
        </div>

        <section class="hero">
            <div class="wallet-info">
                <span style="font-weight: 600;">Main Account</span>
                <span class="coin-tag"><i class="fa-solid fa-coins" style="font-size: 9px;"></i> SILRAN COIN</span>
            </div>
            <div class="balance-row">
                <div class="balance-amount" id="totalBalance">SRC 0.00</div>
                <button class="receive-btn" onclick="showSChainExplorer()">
                    <i class="fas fa-link"></i> S-CHAIN
                </button>
            </div>
        </section>

        <nav class="quick-actions">
            <div class="action-item" onclick="showP2PModal()">
                <div class="icon-circle"><i class="fa-solid fa-handshake"></i></div>
                <span>P2P Trade</span>
            </div>
            <div class="action-item" onclick="showSellModal()">
                <div class="icon-circle"><i class="fa-solid fa-money-bill-wave"></i></div>
                <span>Sell</span>
            </div>
            <div class="action-item" onclick="showSendModal()">
                <div class="icon-circle"><i class="fa-solid fa-paper-plane"></i></div>
                <span>Send</span>
            </div>
        </nav>

        <div class="banner">
            <div class="banner-content">
                <h3>What Is Silran Coin?</h3>
                <p>Silran Coin is a digital currency designed to represent real-world value in digital form. It is built to support transactions and value exchange between physical and digital economic systems. Silran Coin is not government-issued money and does not operate as a banking institution.</p>
            </div>
            <div class="banner-icon"><i class="fa-solid fa-mobile-screen-button"></i></div>
        </div>

        <div class="section-header">
            <span>Portfolio Performance</span>
            <span class="see-all">View All</span>
        </div>

        <div class="card-grid">
            <div class="data-card">
                <div class="card-top">
                    <i class="fa-solid fa-money-bill-wave" style="color: #7b3fe4;"></i>
                    <span class="card-title">SRC/NGN</span>
                </div>
                <div class="card-val" id="srcNgnValue">₦0.00</div>
                <div class="price-change" id="srcNgnChange">
                    <i class="fas fa-arrow-up"></i>
                    <span>₦0.00 (0.00%)</span>
                </div>
                <div class="card-change" style="font-size: 10px; color: var(--text-dim); margin-top: 4px;">24h change</div>
            </div>
            <div class="data-card">
                <div class="card-top">
                    <i class="fa-solid fa-coins" style="color: #e5e7eb;"></i>
                    <span class="card-title">Market Cap</span>
                </div>
                <div class="card-val" id="marketCap">₦0.00</div>
                <div class="card-change" style="font-size: 10px; color: var(--text-dim); margin-top: 4px;">Total value in circulation</div>
            </div>
        </div>

        <!-- Ecosystem Reserve Section -->
        <section class="ecosystem-reserve">
            <div class="section-header">
                <span>SRC ECOSYSTEM RESERVE</span>
            </div>
            <div class="reserve-list" id="reserveList">
                <!-- Reserve items will be dynamically loaded -->
            </div>
        </section>
    </div>

    <!-- Modals -->
    <!-- S-CHAIN Explorer Modal -->
    <div class="modal-overlay" id="sChainModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-link"></i> S-CHAIN Explorer
                </h2>
                <div class="close-modal" onclick="closeModal('sChainModal')">×</div>
            </div>
            
            <div class="schain-date-range">
                <input type="text" id="dateRangeStart" class="schain-date-input" placeholder="Start Date">
                <input type="text" id="dateRangeEnd" class="schain-date-input" placeholder="End Date">
                <button class="schain-search-btn" onclick="searchDateRange()">Search</button>
            </div>

            <div class="block-container" id="blockContainer">
                <div class="no-results">
                    <i class="fas fa-cube"></i>
                    <p>Select a date range to view blocks</p>
                </div>
            </div>
        </div>
    </div>

    <!-- P2P Modal -->
    <div class="modal-overlay" id="p2pModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">P2P Exchange</h2>
                <div class="close-modal" onclick="closeModal('p2pModal')">×</div>
            </div>
            
            <div class="p2p-container">
                <div class="p2p-header">
                    <div class="p2p-icon-wrapper">
                        <i class="fa-solid fa-handshake"></i>
                    </div>
                    <h3 class="p2p-title">Peer-to-Peer Trading</h3>
                    <p class="p2p-subtitle">Connect with the community • Trade directly • Best rates</p>
                </div>

                <div class="p2p-features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fa-solid fa-bolt"></i>
                        </div>
                        <div class="feature-text">
                            <strong>Instant Trades</strong>
                            Match with buyers/sellers
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fa-solid fa-shield"></i>
                        </div>
                        <div class="feature-text">
                            <strong>Secure Escrow</strong>
                            Community- traders
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fa-solid fa-chart-line"></i>
                        </div>
                        <div class="feature-text">
                            <strong>Best Rates</strong>
                            Set your own price or accept offers
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fa-solid fa-globe"></i>
                        </div>
                        <div class="feature-text">
                            <strong>Global Market</strong>
                            P2P trade methods supported
                        </div>
                    </div>
                </div>

                <div class="p2p-community">
                    <p>
                        <i class="fa-solid fa-circle-exclamation" style="color: var(--accent-purple);"></i>
                        All P2P trading happens in our official Telegram community. 
                        Join the channels below to start trading instantly with other members.
                    </p>
                </div>

                <!-- Telegram Action Buttons -->
                <a href="https://t.me/+daCVSsQNU9Q4ZjQ0" target="_blank" class="telegram-btn">
                    <i class="fab fa-telegram-plane"></i>
                    Join Official Channel
                </a>
                <a href="https://t.me/c/2989456855/52" target="_blank" class="telegram-btn secondary">
                    <i class="fab fa-telegram-plane"></i>
                    Join P2P Discussion Group
                </a>

                <div class="p2p-footer">
                    <i class="fa-solid fa-circle-info"></i>
                    Stay updated with announcements & connect with traders
                </div>
            </div>
        </div>
    </div>

    <!-- Security Setup Modal -->
    <div class="modal-overlay" id="securitySetupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Security Setup</h2>
                <div class="close-modal" onclick="closeSecuritySetupModal()">×</div>
            </div>
            
            <div class="info-card">
                <i class="fas fa-info-circle"></i>
                <div>
                    <strong>Important:</strong> This is a one-time setup. Once saved, your security answer cannot be changed or retrieved.
                </div>
            </div>

            <div class="info-card warning-card">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    This answer will be used if you forget your password. Make sure it's something you'll remember.
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Security Question</label>
                <input type="text" class="input-field" value="What's your mother's maiden name?" readonly style="background: rgba(255,255,255,0.03);">
            </div>

            <div class="input-group">
                <label class="input-label">Your Answer <span style="color: var(--text-dim); font-size: 12px;">(10 characters maximum)</span></label>
                <input type="text" id="securityAnswer" class="input-field" placeholder="Enter your answer" maxlength="10" oninput="validateSecurityAnswer()">
            </div>

            <button id="saveSecurityAnswerBtn" class="btn btn-primary" onclick="saveSecurityAnswer()" disabled>
                <i class="fas fa-save"></i> Save Security Answer
            </button>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal-overlay" id="forgotPasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Recover Your Password</h2>
                <div class="close-modal" onclick="closeForgotPasswordModal()">×</div>
            </div>
            
            <div class="info-card">
                <i class="fas fa-shield-alt"></i>
                <div>
                    Answer your security question to reveal your password
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Wallet ID</label>
                <input type="text" id="forgotWalletID" class="input-field" value="" readonly style="background: rgba(255,255,255,0.03);">
            </div>

            <div class="input-group">
                <label class="input-label">Security Question</label>
                <input type="text" class="input-field" value="What's your mother's maiden name?" readonly style="background: rgba(255,255,255,0.03);">
            </div>

            <div class="input-group">
                <label class="input-label">Your Answer</label>
                <input type="text" id="forgotSecurityAnswer" class="input-field" placeholder="Enter your security answer">
            </div>

            <button class="btn btn-primary" onclick="verifySecurityAnswer()">
                <i class="fas fa-eye"></i> Reveal My Password
            </button>
        </div>
    </div>

    <!-- Password Reveal Modal -->
    <div class="modal-overlay" id="passwordRevealModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Your Password</h2>
                <div class="close-modal" onclick="closePasswordRevealModal()">×</div>
            </div>
            
            <div class="info-card success-card">
                <i class="fas fa-check-circle"></i>
                <div>
                    Identity verified! Here is your password
                </div>
            </div>

            <div class="password-reveal-card">
                <div style="color: var(--text-dim); font-size: 14px;">Your 4-digit Password:</div>
                <div class="password-display" id="passwordDisplay">0000</div>
                <div class="copy-instruction">Click on the password above to select it, or use the copy button below</div>
                <button class="copy-btn" onclick="copyPasswordToClipboard()">
                    <i class="fas fa-copy"></i> Copy Password
                </button>
            </div>

            <div class="info-card warning-card">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>Important:</strong> This is your original password. Keep it safe and don't share it with anyone.
                </div>
            </div>

            <button class="btn btn-primary" onclick="closePasswordRevealModal()">
                <i class="fas fa-check"></i> I've Copied It
            </button>
        </div>
    </div>

    <!-- Buy Modal (Original - kept for reference but not used) -->
    <div class="modal-overlay" id="buyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Buy Silran Coin</h2>
                <div class="close-modal" onclick="closeModal('buyModal')">×</div>
            </div>
            
            <div class="info-card">
                <i class="fas fa-info-circle"></i>
                <div>
                    <strong>Instructions:</strong> Transfer money to the account below and your SRC will be credited automatically.
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Amount in Naira (₦)</label>
                <input type="number" id="buyAmount" class="input-field" placeholder="Enter amount to invest" min="100" oninput="calculateBuy()">
            </div>

            <div class="fee-display">
                <div class="fee-item">
                    <span>Buy Fee:</span>
                    <span>₦50 (Fixed)</span>
                </div>
                <div class="fee-item">
                    <span>You'll Get:</span>
                    <span id="buyGetAmount">0 SRC</span>
                </div>
                <div class="fee-item">
                    <span>Total to Pay:</span>
                    <span id="buyTotalAmount">₦0.00</span>
                </div>
            </div>

            <div class="info-card">
                <i class="fas fa-university"></i>
                <div>
                    <strong>Bank:</strong> #<br>
                    <strong>Account:</strong> #<br>
                    <strong>Name:</strong> #<br>
                    <strong>Reference:</strong> <span id="buyReference">BUY-0000</span>
                </div>
            </div>

            <button class="btn btn-primary" onclick="submitBuyRequest()">
                <i class="fas fa-shopping-cart"></i> I've Made Payment
            </button>
        </div>
    </div>

    <!-- Sell Modal with UPDATED ₦1,000 FEE -->
    <div class="modal-overlay" id="sellModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Sell Silran Coin</h2>
                <div class="close-modal" onclick="closeModal('sellModal')">×</div>
            </div>
            
            <div class="info-card warning-card">
                <i class="fas fa-exclamation-triangle"></i>
                <div>Withdrawal Fee: ₦1,000 Fixed • Minimum Payout: ₦5,000</div>
            </div>

            <div class="input-group">
                <label class="input-label">Token Units to Sell</label>
                <input type="number" id="sellTokenUnits" class="input-field" placeholder="Enter amount of SRC to sell" min="0" step="0.0001" oninput="calculateSell()">
            </div>

            <div class="fee-display">
                <div class="fee-item">
                    <span>Current Price:</span>
                    <span id="sellCurrentPrice">₦0.00 per SRC</span>
                </div>
                <div class="fee-item">
                    <span>Gross Value:</span>
                    <span id="sellGrossValue">₦0.00</span>
                </div>
                <div class="fee-item">
                    <span>Sell Fee:</span>
                    <span>₦1,000 (Fixed)</span>
                </div>
                <div class="fee-item">
                    <span>Net Payout:</span>
                    <span id="sellNetPayout">₦0.00</span>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Email Address</label>
                <input type="email" id="sellEmail" class="input-field" placeholder="Enter your email">
            </div>

            <div class="input-group">
                <label class="input-label">Bank Account Number</label>
                <input type="text" id="sellAccountNumber" class="input-field" placeholder="Enter your account number">
            </div>

            <div class="input-group">
                <label class="input-label">Bank Name</label>
                <input type="text" id="sellBankName" class="input-field" placeholder="Enter your bank name">
            </div>

            <button class="btn btn-primary" id="sellButton" onclick="submitSellRequest()">
                <i class="fas fa-check-circle"></i> Submit Sell Request
            </button>
        </div>
    </div>

    <!-- Send Modal with Loading Animation -->
    <div class="modal-overlay" id="sendModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Send Silran Coin</h2>
                <div class="close-modal" onclick="closeModal('sendModal')">×</div>
            </div>

            <div class="fee-display">
                <div class="fee-item">
                    <span>Transfer Fee:</span>
                    <span>2%</span>
                </div>
                <div class="fee-item">
                    <span>Recipient Gets:</span>
                    <span id="sendNetAmount">0 SRC</span>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Recipient Wallet ID</label>
                <input type="text" id="recipientID" class="input-field" placeholder="Enter 4-digit Wallet ID" maxlength="4" oninput="calculateSend()">
            </div>

            <div class="input-group">
                <label class="input-label">Amount (SRC)</label>
                <input type="number" id="transferAmount" class="input-field" placeholder="Enter amount to send" min="0" step="0.0001" oninput="calculateSend()">
            </div>

            <button class="btn btn-primary send-button" id="sendButton" onclick="sendCoins()">
                <span id="sendButtonText">Send Coins</span>
                <span id="sendButtonIcon"><i class="fas fa-paper-plane"></i></span>
            </button>
        </div>
    </div>

    <!-- Receive Modal (Original - kept but repurposed) -->
    <div class="modal-overlay" id="receiveModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Your Wallet Info</h2>
                <div class="close-modal" onclick="closeModal('receiveModal')">×</div>
            </div>
            
            <div class="info-card">
                <i class="fas fa-info-circle"></i>
                <div>Share this information to receive Silran Coins</div>
            </div>

            <div class="profile-info">
                <div class="profile-item">
                    <span class="profile-label">Wallet ID</span>
                    <span class="profile-value" id="receiveWalletID">0000</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Account Name</span>
                    <span class="profile-value">Silran Coin Wallet</span>
                </div>
            </div>

            <div class="info-card">
                <i class="fas fa-university"></i>
                <div>
                    <strong>Bank:</strong> #<br>
                    <strong>Account:</strong> #<br>
                    <strong>Name:</strong> #<br>
                    <strong>Reference:</strong> SEND-<span id="receiveReference">0000</span>
                </div>
            </div>

            <button class="btn btn-primary" onclick="copyToClipboard('receiveReference')">
                <i class="fas fa-copy"></i> Copy Reference
            </button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Profile</h2>
                <div class="close-modal" onclick="closeModal('profileModal')">×</div>
            </div>
            
            <div class="profile-info">
                <div class="profile-item">
                    <span class="profile-label">Wallet ID</span>
                    <span class="profile-value" id="profileWalletID">0000</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Silran Coin Balance</span>
                    <span class="profile-value" id="profileSRCBalance">0.0000 SRC</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Value in Naira</span>
                    <span class="profile-value" id="profileNGNValue">₦0.00</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Account Type</span>
                    <span class="profile-value">Standard</span>
                </div>
            </div>

            <button class="btn btn-primary" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-item active">
            <i class="fa-solid fa-house nav-icon"></i>
            <span>Home</span>
        </div>
        <div class="nav-item">
            <i class="fa-solid fa-chart-simple nav-icon"></i>
            <span>Market</span>
        </div>
        <div class="nav-item">
            <i class="fa-solid fa-coins nav-icon"></i>
            <span>Mine</span>
        </div>
        <div class="nav-item">
            <i class="fa-solid fa-gamepad nav-icon"></i>
            <span>Games</span>
        </div>
    </nav>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Flatpickr for calendar -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
        // =============================================
        // FIREBASE CONFIGURATION
        // =============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBq6cSj25KWfHYlzJ6UYTbjEafv9hMrJgY",
            authDomain: "cryptosilvx-c4923.firebaseapp.com",
            projectId: "cryptosilvx-c4923",
            storageBucket: "cryptosilvx-c4923.appspot.com",
            messagingSenderId: "265648623060",
            appId: "1:265648623060:web:3ecc402893e873fb2cda41"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // =============================================
        // NOTIFICATION SYSTEM
        // =============================================
        class NotificationSystem {
            constructor() {
                this.container = document.getElementById('notificationContainer');
                this.nextId = 1;
            }
            
            show(message, type = 'info', duration = 5000) {
                const id = this.nextId++;
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.id = `notification-${id}`;
                
                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle',
                    info: 'fas fa-info-circle'
                };
                
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="${icons[type] || icons.info}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${this.getTitle(type)}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                `;
                
                this.container.appendChild(notification);
                
                if (duration > 0) {
                    setTimeout(() => {
                        const notif = document.getElementById(`notification-${id}`);
                        if (notif) {
                            notif.style.animation = 'slideOutRight 0.3s ease-out';
                            notif.style.opacity = '0';
                            setTimeout(() => notif.remove(), 300);
                        }
                    }, duration);
                }
                
                return id;
            }
            
            getTitle(type) {
                const titles = {
                    success: 'Success',
                    error: 'Error',
                    warning: 'Warning',
                    info: 'Information'
                };
                return titles[type] || 'Notification';
            }
        }

        const notificationSystem = new NotificationSystem();
        
        function showNotification(message, type = 'info', duration = 5000) {
            return notificationSystem.show(message, type, duration);
        }

        // =============================================
        // USER AGREEMENT SYSTEM
        // =============================================
        const AGREEMENT_STORAGE_KEY = 'silran_coin_agreement_accepted';
        const DEVICE_ID_KEY = 'silran_coin_device_id';

        function getDeviceId() {
            let deviceId = localStorage.getItem(DEVICE_ID_KEY);
            if (!deviceId) {
                // Generate a unique device ID
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem(DEVICE_ID_KEY, deviceId);
            }
            return deviceId;
        }

        function hasAcceptedAgreement() {
            const deviceId = getDeviceId();
            const agreementData = localStorage.getItem(AGREEMENT_STORAGE_KEY);
            
            if (!agreementData) {
                return false;
            }
            
            try {
                const parsedData = JSON.parse(agreementData);
                // Check if this device has accepted the agreement
                return parsedData.deviceId === deviceId;
            } catch (error) {
                console.error('Error parsing agreement data:', error);
                return false;
            }
        }

        function acceptAgreement() {
            const deviceId = getDeviceId();
            const agreementData = {
                accepted: true,
                deviceId: deviceId,
                acceptedDate: new Date().toISOString(),
                version: '1.0'
            };
            
            localStorage.setItem(AGREEMENT_STORAGE_KEY, JSON.stringify(agreementData));
            
            // Hide agreement and show login
            document.getElementById('userAgreementOverlay').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            
            showNotification('Thank you for accepting the User Agreement!', 'success');
        }

        function updateAgreeButton() {
            const agreeCheckbox = document.getElementById('agreeCheckbox');
            const agreeButton = document.getElementById('agreeButton');
            
            agreeButton.disabled = !agreeCheckbox.checked;
        }

        function setupAgreementScroll() {
            const agreementContent = document.getElementById('agreementContent');
            const scrollIndicator = document.getElementById('scrollIndicator');
            
            agreementContent.addEventListener('scroll', function() {
                const scrollPercentage = (this.scrollTop / (this.scrollHeight - this.clientHeight)) * 100;
                
                if (scrollPercentage > 80) {
                    scrollIndicator.style.display = 'none';
                } else {
                    scrollIndicator.style.display = 'block';
                }
            });
        }

        // =============================================
        // INITIALIZATION
        // =============================================
        window.onload = function() {
            // First, check if user has accepted agreement
            if (!hasAcceptedAgreement()) {
                document.getElementById('userAgreementOverlay').style.display = 'flex';
                setupAgreementScroll();
            } else {
                document.getElementById('loginPage').style.display = 'flex';
            }
            
            validateLoginInputs();
            loadMarketData();
            checkFirebaseConnection();
            setupSearchFunctionality();
            initializeDatePickers();
        };

        // Initialize flatpickr for date ranges
        function initializeDatePickers() {
            flatpickr("#dateRangeStart", {
                dateFormat: "Y-m-d",
                maxDate: "today"
            });

            flatpickr("#dateRangeEnd", {
                dateFormat: "Y-m-d",
                maxDate: "today"
            });
        }

        // =============================================
        // S-CHAIN EXPLORER FUNCTIONS
        // =============================================
        function showSChainExplorer() {
            if (!currentUserID) {
                showNotification('Please login first', 'error');
                return;
            }
            document.getElementById('sChainModal').style.display = 'flex';
        }

        // Search by date range
        async function searchDateRange() {
            const startDate = document.getElementById('dateRangeStart').value;
            const endDate = document.getElementById('dateRangeEnd').value;

            if (!startDate || !endDate) {
                showNotification('Please select both start and end dates', 'error');
                return;
            }

            try {
                // Convert to Date objects for comparison
                const start = new Date(startDate);
                start.setHours(0, 0, 0, 0);
                
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999);

                // Query transactions in date range
                const transactionsSnapshot = await db.collection('transactions')
                    .where('timestamp', '>=', start.toISOString())
                    .where('timestamp', '<=', end.toISOString())
                    .orderBy('timestamp', 'desc')
                    .get();

                // Display blocks
                displayBlocks(transactionsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })), 
                    `Blocks from ${startDate} to ${endDate}`);

            } catch (error) {
                console.error('Error searching date range:', error);
                showNotification('Error searching date range', 'error');
            }
        }

        // Display blocks in the container
        function displayBlocks(transactions, title) {
            const container = document.getElementById('blockContainer');
            
            if (!transactions || transactions.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-cube"></i>
                        <p>No blocks found for this date range</p>
                    </div>
                `;
                return;
            }

            let html = `<div style="margin-bottom: 10px; color: var(--text-dim); font-size: 12px;">${title}</div>`;
            
            transactions.forEach((tx, index) => {
                const blockNumber = index + 1;
                const fee = tx.amount ? tx.amount * 0.02 : 0; // 2% fee
                const date = new Date(tx.timestamp);
                const formattedDate = date.toLocaleString('en-US', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });

                html += `
                    <div class="block-card">
                        <div class="block-header">
                            <span class="block-number">Block #${blockNumber}</span>
                            <span class="block-status"><i class="fas fa-check-circle"></i> Confirmed</span>
                        </div>
                        <div class="block-detail">
                            <span class="block-label">Transaction ID:</span>
                            <span class="block-value block-txid">${tx.id || 'N/A'}</span>
                        </div>
                        <div class="block-detail">
                            <span class="block-label">From:</span>
                            <span class="block-value">Wallet ${tx.fromWallet || 'N/A'}</span>
                        </div>
                        <div class="block-detail">
                            <span class="block-label">To:</span>
                            <span class="block-value">Wallet ${tx.toWallet || 'N/A'}</span>
                        </div>
                        <div class="block-detail">
                            <span class="block-label">Amount:</span>
                            <span class="block-value">${tx.amount ? tx.amount.toFixed(4) : '0'} SRC</span>
                        </div>
                        <div class="block-detail">
                            <span class="block-label">Timestamp:</span>
                            <span class="block-value">${formattedDate}</span>
                        </div>
                        <div class="block-detail">
                            <span class="block-label">Transaction Fee:</span>
                            <span class="block-value">${fee.toFixed(6)} SRC (2%)</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // =============================================
        // SEND FUNCTIONS WITH LOADING ANIMATION
        // =============================================
        let isSending = false;

        function showSendLoading() {
            const sendButton = document.getElementById('sendButton');
            const sendButtonText = document.getElementById('sendButtonText');
            const sendButtonIcon = document.getElementById('sendButtonIcon');
            
            sendButton.classList.add('loading');
            sendButton.disabled = true;
            sendButtonText.textContent = 'Processing';
            sendButtonIcon.innerHTML = '<span class="send-spinner"></span>';
        }

        function showSendSuccess() {
            const sendButton = document.getElementById('sendButton');
            const sendButtonText = document.getElementById('sendButtonText');
            const sendButtonIcon = document.getElementById('sendButtonIcon');
            
            sendButton.classList.remove('loading');
            sendButton.classList.add('success');
            sendButtonText.textContent = 'Sent!';
            sendButtonIcon.innerHTML = '<span class="send-check"><i class="fas fa-check"></i></span>';
            
            // Reset button after 2 seconds
            setTimeout(() => {
                sendButton.classList.remove('success');
                sendButton.disabled = false;
                sendButtonText.textContent = 'Send Coins';
                sendButtonIcon.innerHTML = '<i class="fas fa-paper-plane"></i>';
            }, 2000);
        }

        function resetSendButton() {
            const sendButton = document.getElementById('sendButton');
            const sendButtonText = document.getElementById('sendButtonText');
            const sendButtonIcon = document.getElementById('sendButtonIcon');
            
            sendButton.classList.remove('loading', 'success');
            sendButton.disabled = false;
            sendButtonText.textContent = 'Send Coins';
            sendButtonIcon.innerHTML = '<i class="fas fa-paper-plane"></i>';
            isSending = false;
        }

        async function sendCoins() {
            if (isSending) {
                showNotification('Transaction already in progress', 'warning');
                return;
            }

            const recipientID = document.getElementById('recipientID').value.trim();
            const amount = parseFloat(document.getElementById('transferAmount').value) || 0;
            const TRANSFER_FEE = 0.02;
            
            if (!recipientID || recipientID.length !== 4 || !/^\d{4}$/.test(recipientID)) {
                showNotification('Invalid recipient Wallet ID', 'error');
                return;
            }
            
            if (recipientID === currentUserID) {
                showNotification('Cannot send to yourself', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showNotification('Invalid amount', 'error');
                return;
            }
            
            const fee = amount * TRANSFER_FEE;
            const totalDeduction = amount;
            
            if (totalDeduction > currentUserData.tokenUnits) {
                showNotification('Insufficient SRC balance', 'error');
                return;
            }
            
            try {
                isSending = true;
                showSendLoading();

                const recipientDoc = await db.collection('wallets').doc(recipientID).get();
                if (!recipientDoc.exists) {
                    resetSendButton();
                    showNotification('Recipient wallet does not exist', 'error');
                    return;
                }
                
                const recipientData = recipientDoc.data();
                const netAmount = amount - fee;
                
                const newSenderBalance = currentUserData.tokenUnits - totalDeduction;
                await db.collection('wallets').doc(currentUserID).update({
                    tokenUnits: newSenderBalance
                });
                
                const newRecipientBalance = (recipientData.tokenUnits || 0) + netAmount;
                await db.collection('wallets').doc(recipientID).update({
                    tokenUnits: newRecipientBalance
                });
                
                currentUserData.tokenUnits = newSenderBalance;
                
                // Store transaction in blockchain
                const transactionData = {
                    fromWallet: currentUserID,
                    toWallet: recipientID,
                    amount: amount,
                    fee: fee,
                    timestamp: new Date().toISOString(),
                    status: 'confirmed'
                };
                
                await db.collection('transactions').add(transactionData);
                
                const message = 
                    `📤 TRANSFER - SILRAN COIN\n\n` +
                    `👤 From: ${currentUserID}\n` +
                    `👤 To: ${recipientID}\n` +
                    `💰 Amount: ${amount.toFixed(4)} SRC\n` +
                    `💸 Fee: ${fee.toFixed(4)} SRC (2%)\n` +
                    `💵 Received: ${netAmount.toFixed(4)} SRC\n` +
                    `⏰ Time: ${new Date().toLocaleString()}`;
                
                await sendTelegramMessage(message);
                
                document.getElementById('recipientID').value = '';
                document.getElementById('transferAmount').value = '';
                
                showSendSuccess();
                updateUserInterface();
                
                // Close modal after success animation
                setTimeout(() => {
                    closeModal('sendModal');
                    resetSendButton();
                }, 1500);
                
                showNotification(`Successfully sent ${netAmount.toFixed(4)} SRC to wallet ${recipientID}`, 'success');
                
            } catch (error) {
                console.error('Transfer error:', error);
                resetSendButton();
                showNotification('Error processing transfer. Please try again.', 'error');
            } finally {
                isSending = false;
            }
        }

        // Prevent user from closing agreement without accepting
        window.addEventListener('beforeunload', function(e) {
            if (document.getElementById('userAgreementOverlay').style.display === 'flex') {
                e.preventDefault();
                e.returnValue = 'You must accept the User Agreement to continue.';
            }
        });

        // Disable keyboard shortcuts when agreement is shown
        document.addEventListener('keydown', function(event) {
            if (document.getElementById('userAgreementOverlay').style.display === 'flex') {
                // Allow only Tab and Arrow keys for navigation
                const allowedKeys = ['Tab', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
                if (!allowedKeys.includes(event.key) && !event.ctrlKey) {
                    event.preventDefault();
                }
                
                // Prevent F5 refresh
                if (event.key === 'F5' || (event.ctrlKey && event.key === 'r')) {
                    event.preventDefault();
                    showNotification('Please accept the User Agreement first', 'warning');
                }
            }
        });

        // =============================================
        // ENHANCED SEARCH FUNCTIONALITY
        // =============================================
        function setupSearchFunctionality() {
            const mainSearch = document.getElementById('mainSearch');
            const resultsSearch = document.getElementById('resultsSearch');
            const searchSuggestions = document.getElementById('searchSuggestions');
            
            // Main search input functionality
            mainSearch.addEventListener('input', function() {
                const searchText = this.value.trim();
                const clearBtn = this.parentNode.querySelector('.clear-search');
                
                if (searchText.length > 0) {
                    clearBtn.style.display = 'block';
                } else {
                    clearBtn.style.display = 'none';
                }
            });
            
            mainSearch.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    performGoogleSearch(this.value);
                }
            });
            
            // Results search input functionality
            resultsSearch.addEventListener('input', function() {
                const searchText = this.value.trim();
                const clearBtn = this.parentNode.querySelector('.clear-search');
                
                if (searchText.length > 0) {
                    clearBtn.style.display = 'block';
                } else {
                    clearBtn.style.display = 'none';
                }
            });
            
            resultsSearch.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    const query = this.value.trim();
                    if (query) {
                        performGoogleSearchInResults(query);
                    }
                }
            });
            
            // Focus search when clicking search icon
            document.querySelector('.search-icon').addEventListener('click', function() {
                focusSearch();
            });
        }

        function focusSearch() {
            const mainSearch = document.getElementById('mainSearch');
            mainSearch.focus();
            showSearchSuggestions();
        }

        function showSearchSuggestions() {
            const searchSuggestions = document.getElementById('searchSuggestions');
            const mainSearch = document.getElementById('mainSearch');
            
            if (mainSearch.value.trim().length === 0) {
                searchSuggestions.style.display = 'block';
            }
        }

        function hideSearchSuggestions() {
            setTimeout(() => {
                const searchSuggestions = document.getElementById('searchSuggestions');
                searchSuggestions.style.display = 'none';
            }, 200);
        }

        function clearMainSearch() {
            const mainSearch = document.getElementById('mainSearch');
            const clearBtn = mainSearch.parentNode.querySelector('.clear-search');
            
            mainSearch.value = '';
            clearBtn.style.display = 'none';
            mainSearch.focus();
        }

        function clearSearch() {
            const resultsSearch = document.getElementById('resultsSearch');
            const clearBtn = resultsSearch.parentNode.querySelector('.clear-search');
            
            resultsSearch.value = '';
            clearBtn.style.display = 'none';
            resultsSearch.focus();
        }

        function quickSearch(query) {
            const mainSearch = document.getElementById('mainSearch');
            mainSearch.value = query;
            performGoogleSearch(query);
        }

        function performGoogleSearch(query) {
            if (!query || query.trim() === '') {
                showNotification('Please enter something to search', 'warning');
                return;
            }
            
            // Show loading overlay
            showSearchLoading();
            
            // Build Google search URL
            const encodedQuery = encodeURIComponent(query);
            const searchUrl = `https://www.google.com/search?q=${encodedQuery}&igu=1&gws_rd=cr`;
            
            // Open search results view
            setTimeout(() => {
                openSearchResultsView(searchUrl, query);
                hideSearchLoading();
            }, 500);
        }

        function performGoogleSearchInResults(query) {
            if (!query || query.trim() === '') {
                showNotification('Please enter something to search', 'warning');
                return;
            }
            
            // Update results frame with new search
            const encodedQuery = encodeURIComponent(query);
            const searchUrl = `https://www.google.com/search?q=${encodedQuery}&igu=1&gws_rd=cr`;
            
            document.getElementById('resultsFrame').src = searchUrl;
        }

        function openSearchResultsView(searchUrl, searchQuery) {
            const searchResultsView = document.getElementById('searchResultsView');
            const resultsFrame = document.getElementById('resultsFrame');
            const resultsSearch = document.getElementById('resultsSearch');
            const walletPage = document.getElementById('walletPage');
            
            // Hide wallet page, show search results
            walletPage.style.display = 'none';
            searchResultsView.style.display = 'flex';
            
            // Set search query and load results
            resultsSearch.value = searchQuery;
            resultsFrame.src = searchUrl;
            
            // Show clear button if there's text
            const clearBtn = resultsSearch.parentNode.querySelector('.clear-search');
            clearBtn.style.display = searchQuery ? 'block' : 'none';
            
            // Focus on search input in results view
            setTimeout(() => {
                resultsSearch.focus();
            }, 100);
        }

        function closeSearchView() {
            const searchResultsView = document.getElementById('searchResultsView');
            const walletPage = document.getElementById('walletPage');
            
            searchResultsView.style.display = 'none';
            walletPage.style.display = 'block';
            
            // Clear results frame
            document.getElementById('resultsFrame').src = '';
            
            // Focus back on main search
            setTimeout(() => {
                const mainSearch = document.getElementById('mainSearch');
                mainSearch.focus();
            }, 100);
        }

        function showSearchLoading() {
            document.getElementById('searchLoading').style.display = 'flex';
        }

        function hideSearchLoading() {
            document.getElementById('searchLoading').style.display = 'none';
        }

        // =============================================
        // APP STATE
        // =============================================
        let currentUserID = null;
        let currentUserData = null;
        let currentPrice = 100.00;
        let price24hAgo = 100.00;
        let totalCoinsInEcosystem = 0;
        let priceListener = null;
        let historicalPrices = [];
        let reserveListener = null;
        let currentReserves = {};

        // Password recovery variables
        let forgotPasswordWalletID = null;
        let recoveredPassword = null;

        // Telegram bot configuration
        const telegramBotToken = '7922730092:AAG9SKMfjwCP1nmEJ9U-kboj_0XPNveQlsM';
        const telegramChatId = '7340540197';

        // Reserve configuration
        const reserveConfig = {
            'fixed_deposit': {
                name: 'Fixed Deposit',
                icon: 'fa-money-bill-wave',
                category: 'Fiat',
                decimalPlaces: 2
            },
            'optimix_portfolio': {
                name: 'OptiMix Portfolio',
                icon: 'fa-chart-line',
                category: 'Fiat',
                decimalPlaces: 2
            },
            'usdc': {
                name: 'USDC',
                icon: 'fa-dollar-sign',
                category: 'Stablecoin',
                decimalPlaces: 4
            },
            'btc': {
                name: 'Bitcoin',
                icon: 'fa-fire',
                category: 'Cryptocurrency',
                decimalPlaces: 8
            },
            'ethereum': {
                name: 'Ethereum',
                icon: 'fa-fire',
                category: 'Cryptocurrency',
                decimalPlaces: 6
            },
            'xrp': {
                name: 'XRP',
                icon: 'fa-bolt',
                category: 'Cryptocurrency',
                decimalPlaces: 2
            },
            'solana': {
                name: 'Solana',
                icon: 'fa-fire',
                category: 'Cryptocurrency',
                decimalPlaces: 4
            },
            'avax': {
                name: 'AVAX',
                icon: 'fa-snowflake',
                category: 'Cryptocurrency',
                decimalPlaces: 4
            }
        };

        // Search functionality variables
        let searchHistory = [];

        // =============================================
        // DEBUG FUNCTIONS
        // =============================================
        async function checkFirebaseConnection() {
            try {
                console.log('🔌 Testing Firebase connection...');
                const testDoc = await db.collection('reserves').doc('current').get();
                console.log('✅ Firebase connection successful:', testDoc.exists);
                
                if (!testDoc.exists) {
                    console.log('⚠️ No reserves document found. Creating sample data...');
                    await createSampleReserves();
                }
                
            } catch (error) {
                console.error('❌ Firebase connection error:', error);
                showNotification('Cannot connect to database. Please check your internet connection.', 'error');
            }
        }

        // =============================================
        // ECOSYSTEM RESERVE FUNCTIONS
        // =============================================
        async function loadReserves() {
            try {
                console.log('🔍 Loading reserves from Firebase...');
                
                const reservesDoc = await db.collection('reserves').doc('current').get();
                
                console.log('📄 Reserves document exists:', reservesDoc.exists);
                
                if (reservesDoc.exists) {
                    currentReserves = reservesDoc.data();
                    console.log('📊 Reserves data:', currentReserves);
                    renderReserves();
                } else {
                    console.log('⚠️ No reserves document found in Firebase');
                    await createSampleReserves();
                }

                startReserveListener();
                
            } catch (error) {
                console.error('❌ Error loading reserves:', error);
                showNotification('Error loading ecosystem reserves', 'error');
                renderEmptyReserves();
            }
        }

        function startReserveListener() {
            if (reserveListener) {
                reserveListener();
            }
            
            reserveListener = db.collection('reserves').doc('current')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        console.log('🔄 Reserves updated in real-time');
                        currentReserves = doc.data();
                        renderReserves();
                    }
                }, (error) => {
                    console.error('❌ Reserve listener error:', error);
                });
        }

        function renderReserves() {
            const reserveList = document.getElementById('reserveList');
            reserveList.innerHTML = '';
            
            if (!currentReserves || Object.keys(currentReserves).length === 0) {
                console.log('⚠️ No reserve data to render');
                renderEmptyReserves();
                return;
            }

            for (const [reserveId, reserveData] of Object.entries(currentReserves)) {
                const config = reserveConfig[reserveId];
                
                if (!config) {
                    console.warn(`⚠️ No config found for reserve: ${reserveId}`);
                    continue;
                }

                const value = reserveData.value || 0;
                let displayValue;
                
                if (config.category === 'Fiat') {
                    displayValue = `₦${formatNumber(value, config.decimalPlaces)}`;
                } else {
                    displayValue = `${formatNumber(value, config.decimalPlaces)} ${config.name}`;
                }

                const categoryClass = getCategoryClass(reserveId);
                
                const reserveItem = document.createElement('div');
                reserveItem.className = 'reserve-item';
                reserveItem.innerHTML = `
                    <div class="reserve-left">
                        <div class="reserve-icon ${categoryClass}">
                            <i class="fas ${config.icon}"></i>
                        </div>
                        <div class="reserve-details">
                            <h3>${config.name}</h3>
                            <p>${config.category} Reserve</p>
                        </div>
                    </div>
                    <div class="reserve-value">
                        <h3>${displayValue}</h3>
                        <p>Current Reserve</p>
                    </div>
                `;

                reserveList.appendChild(reserveItem);
            }
            
            if (reserveList.children.length === 0) {
                console.log('⚠️ No reserves rendered, showing empty state');
                renderEmptyReserves();
            }
        }

        function getCategoryClass(reserveId) {
            const classMap = {
                'fixed_deposit': 'fiat',
                'optimix_portfolio': 'fiat',
                'usdc': 'usdc',
                'btc': 'btc',
                'ethereum': 'eth',
                'xrp': 'xrp',
                'solana': 'sol',
                'avax': 'avax'
            };
            
            return classMap[reserveId] || 'fiat';
        }

        function renderEmptyReserves() {
            const reserveList = document.getElementById('reserveList');
            reserveList.innerHTML = `
                <div class="reserve-item">
                    <div class="reserve-left">
                        <div class="reserve-icon fiat">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <div class="reserve-details">
                            <h3>Loading Reserves</h3>
                            <p>Fetching data from server...</p>
                        </div>
                    </div>
                    <div class="reserve-value">
                        <h3>₦0.00</h3>
                        <p>Current Reserve</p>
                    </div>
                </div>
            `;
        }

        async function createSampleReserves() {
            try {
                console.log('📝 Creating sample reserves...');
                
                const sampleReserves = {
                    fixed_deposit: {
                        value: 15000000,
                        unit: "NGN",
                        updatedAt: new Date().toISOString()
                    },
                    optimix_portfolio: {
                        value: 7500000,
                        unit: "NGN",
                        updatedAt: new Date().toISOString()
                    },
                    usdc: {
                        value: 50000,
                        unit: "USDC",
                        updatedAt: new Date().toISOString()
                    },
                    btc: {
                        value: 12.5,
                        unit: "BTC",
                        updatedAt: new Date().toISOString()
                    },
                    ethereum: {
                        value: 250,
                        unit: "ETH",
                        updatedAt: new Date().toISOString()
                    },
                    xrp: {
                        value: 100000,
                        unit: "XRP",
                        updatedAt: new Date().toISOString()
                    },
                    solana: {
                        value: 5000,
                        unit: "SOL",
                        updatedAt: new Date().toISOString()
                    },
                    avax: {
                        value: 2500,
                        unit: "AVAX",
                        updatedAt: new Date().toISOString()
                    }
                };
                
                await db.collection('reserves').doc('current').set(sampleReserves);
                console.log('✅ Sample reserves created successfully!');
                
                currentReserves = sampleReserves;
                renderReserves();
                
            } catch (error) {
                console.error('❌ Error creating sample reserves:', error);
                renderEmptyReserves();
            }
        }

        // =============================================
        // UTILITY FUNCTIONS
        // =============================================
        function formatNumber(num, decimals = 2) {
            return parseFloat(num).toLocaleString('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }

        // =============================================
        // SECURITY FUNCTIONS
        // =============================================
        function simpleHash(input) {
            const cleanInput = String(input).toLowerCase().trim();
            let hash = 0;
            
            if (cleanInput.length === 0) return '0';
            
            for (let i = 0; i < cleanInput.length; i++) {
                const char = cleanInput.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            return Math.abs(hash).toString(36);
        }

        function showSecuritySetupModal() {
            if (!currentUserID) {
                showNotification('Please login first', 'error');
                return;
            }
            document.getElementById('securitySetupModal').style.display = 'flex';
        }

        function closeSecuritySetupModal() {
            document.getElementById('securitySetupModal').style.display = 'none';
            document.getElementById('securityAnswer').value = '';
            document.getElementById('saveSecurityAnswerBtn').disabled = true;
        }

        function validateSecurityAnswer() {
            const answer = document.getElementById('securityAnswer').value.trim();
            const saveButton = document.getElementById('saveSecurityAnswerBtn');
            saveButton.disabled = answer.length === 0 || answer.length > 10;
        }

        async function saveSecurityAnswer() {
            const answer = document.getElementById('securityAnswer').value.trim();
            
            if (!answer || answer.length > 10) {
                showNotification('Please enter a valid answer (max 10 characters)', 'error');
                return;
            }

            try {
                const hashedAnswer = simpleHash(answer);
                
                await db.collection('wallets').doc(currentUserID).update({
                    securityAnswer: hashedAnswer,
                    hasSecuritySetup: true,
                    securitySetupDate: new Date().toISOString()
                });

                currentUserData.securityAnswer = hashedAnswer;
                currentUserData.hasSecuritySetup = true;

                const securityBtn = document.getElementById('securitySetupBtn');
                securityBtn.classList.add('set');
                securityBtn.innerHTML = '<i class="fas fa-check"></i>';
                
                setTimeout(() => {
                    securityBtn.style.display = 'none';
                }, 2000);

                closeSecuritySetupModal();
                showNotification('Security answer saved successfully!', 'success');

            } catch (error) {
                console.error('Error saving security answer:', error);
                showNotification('Error saving security answer. Please try again.', 'error');
            }
        }

        function showForgotPasswordFlow() {
            const walletID = document.getElementById('appID').value.trim();
            
            if (!walletID) {
                showNotification('Please enter your Wallet ID first', 'error');
                return;
            }

            forgotPasswordWalletID = walletID;
            document.getElementById('forgotWalletID').value = walletID;
            document.getElementById('forgotPasswordModal').style.display = 'flex';
        }

        function closeForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').style.display = 'none';
            document.getElementById('forgotSecurityAnswer').value = '';
            forgotPasswordWalletID = null;
            recoveredPassword = null;
        }

        function closePasswordRevealModal() {
            document.getElementById('passwordRevealModal').style.display = 'none';
            forgotPasswordWalletID = null;
            recoveredPassword = null;
        }

        async function verifySecurityAnswer() {
            const answer = document.getElementById('forgotSecurityAnswer').value.trim();
            
            if (!answer) {
                showNotification('Please enter your security answer', 'error');
                return;
            }

            try {
                const userDoc = await db.collection('wallets').doc(forgotPasswordWalletID).get();
                
                if (!userDoc.exists) {
                    showNotification('Wallet ID does not exist', 'error');
                    return;
                }

                const userData = userDoc.data();

                if (!userData.hasSecuritySetup || !userData.securityAnswer) {
                    showNotification('This wallet does not have security recovery setup. Please contact admin.', 'error');
                    return;
                }

                const hashedAnswer = simpleHash(answer);
                
                if (hashedAnswer !== userData.securityAnswer) {
                    showNotification('Incorrect security answer', 'error');
                    return;
                }

                recoveredPassword = userData.password;
                document.getElementById('passwordDisplay').textContent = recoveredPassword;
                
                closeForgotPasswordModal();
                document.getElementById('passwordRevealModal').style.display = 'flex';

                showNotification('✅ Password retrieved successfully!', 'success');

            } catch (error) {
                console.error('Error verifying security answer:', error);
                showNotification('Error verifying security answer. Please try again.', 'error');
            }
        }

        function copyPasswordToClipboard() {
            if (!recoveredPassword) return;
            
            navigator.clipboard.writeText(recoveredPassword).then(() => {
                showNotification('✅ Password copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy password: ', err);
                showNotification('Failed to copy password. Please select and copy manually.', 'error');
            });
        }

        // =============================================
        // AUTHENTICATION
        // =============================================
        async function login() {
            const appID = document.getElementById('appID').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!appID || !password) {
                showNotification('Please enter both Wallet ID and Password', 'error');
                return;
            }

            if (appID.length !== 4 || !/^\d{4}$/.test(appID)) {
                showNotification('Wallet ID must be 4 digits', 'error');
                return;
            }

            if (password.length !== 4 || !/^\d{4}$/.test(password)) {
                showNotification('Password must be 4 digits', 'error');
                return;
            }

            try {
                const userDoc = await db.collection('wallets').doc(appID).get();
                
                if (!userDoc.exists) {
                    showNotification('Wallet ID does not exist', 'error');
                    return;
                }

                const userData = userDoc.data();
                
                if (userData.password !== password) {
                    showNotification('Incorrect password', 'error');
                    
                    if (userData.hasSecuritySetup) {
                        document.getElementById('forgotPasswordBtn').style.display = 'flex';
                    }
                    return;
                }

                await db.collection('wallets').doc(appID).update({
                    lastLogin: new Date().toISOString()
                });

                currentUserID = appID;
                currentUserData = userData;
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('walletPage').style.display = 'block';

                document.getElementById('appID').value = '';
                document.getElementById('password').value = '';
                document.getElementById('forgotPasswordBtn').style.display = 'none';

                updateUserInterface();
                startPriceListener();
                loadReserves();
                
                if (!currentUserData.hasSecuritySetup) {
                    showNotification('Login successful! Please set up your security answer for password recovery.', 'info', 8000);
                    
                    const securityBtn = document.getElementById('securitySetupBtn');
                    securityBtn.style.display = 'flex';
                    securityBtn.classList.remove('set');
                    securityBtn.innerHTML = '<i class="fas fa-lock"></i>';
                } else {
                    document.getElementById('securitySetupBtn').style.display = 'none';
                }

                showNotification('Login successful!', 'success');

            } catch (error) {
                console.error('Login error:', error);
                showNotification('Error during login. Please try again.', 'error');
            }
        }

        function validateLoginInputs() {
            const appID = document.getElementById('appID').value.trim();
            const password = document.getElementById('password').value.trim();
            const loginButton = document.getElementById('loginButton');
            loginButton.disabled = !(appID.length === 4 && password.length === 4);
        }

        function validateCreateInputs() {
            const newAppID = document.getElementById('newAppID').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const createButton = document.getElementById('createWalletButton');
            
            createButton.disabled = !(
                newAppID.length === 4 && 
                newPassword.length === 4 && 
                confirmPassword.length === 4 &&
                newPassword === confirmPassword
            );
        }

        function toggleCreateForm() {
            const form = document.getElementById('createForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        async function createWallet() {
            const newAppID = document.getElementById('newAppID').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            if (!newAppID || newAppID.length !== 4 || !/^\d{4}$/.test(newAppID)) {
                showNotification('Wallet ID must be exactly 4 digits', 'error');
                return;
            }

            if (!newPassword || newPassword.length !== 4 || !/^\d{4}$/.test(newPassword)) {
                showNotification('Password must be exactly 4 digits', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }

            try {
                const walletDoc = await db.collection('wallets').doc(newAppID).get();
                if (walletDoc.exists) {
                    showNotification('Wallet ID already exists. Please choose a different one.', 'error');
                    return;
                }

                const walletData = {
                    appID: newAppID,
                    password: newPassword,
                    tokenUnits: 0,
                    hasSecuritySetup: false,
                    securityAnswer: null,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };

                await db.collection('wallets').doc(newAppID).set(walletData);

                // Store wallet creation as genesis transaction
                await db.collection('transactions').add({
                    fromWallet: 'SYSTEM',
                    toWallet: newAppID,
                    amount: 0,
                    fee: 0,
                    timestamp: new Date().toISOString(),
                    type: 'wallet_creation',
                    status: 'confirmed'
                });

                document.getElementById('newAppID').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                document.getElementById('createForm').style.display = 'none';

                showNotification('Wallet created successfully! Please login to set up security recovery.', 'success', 6000);

            } catch (error) {
                console.error('Error creating wallet:', error);
                showNotification('Error creating wallet. Please try again.', 'error');
            }
        }

        function logout() {
            currentUserID = null;
            currentUserData = null;
            
            document.getElementById('walletPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            
            if (priceListener) {
                priceListener();
                priceListener = null;
            }
            if (reserveListener) {
                reserveListener();
                reserveListener = null;
            }
            
            closeAllModals();
            document.getElementById('securitySetupBtn').style.display = 'none';
            document.getElementById('forgotPasswordBtn').style.display = 'none';

            showNotification('Logged out successfully', 'success');
        }

        // =============================================
        // MARKET DATA FUNCTIONS
        // =============================================
        async function loadMarketData() {
            try {
                const priceDoc = await db.collection('settings').doc('currentPrice').get();
                if (priceDoc.exists) {
                    currentPrice = priceDoc.data().price;
                }

                await loadHistoricalPrices();

                const walletsSnapshot = await db.collection('wallets').get();
                totalCoinsInEcosystem = 0;
                walletsSnapshot.forEach(doc => {
                    const data = doc.data();
                    totalCoinsInEcosystem += data.tokenUnits || 0;
                });

                updateMarketDisplay();

            } catch (error) {
                console.error('Error loading market data:', error);
            }
        }

        async function loadHistoricalPrices() {
            try {
                const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);
                
                const historicalSnapshot = await db.collection('priceHistory')
                    .where('timestamp', '>=', twentyFourHoursAgo.toISOString())
                    .orderBy('timestamp', 'desc')
                    .limit(100)
                    .get();
                
                historicalPrices = [];
                historicalSnapshot.forEach(doc => {
                    historicalPrices.push(doc.data());
                });
                
                if (historicalPrices.length > 0) {
                    const oldestPrice = historicalPrices[historicalPrices.length - 1];
                    price24hAgo = oldestPrice.price;
                } else {
                    price24hAgo = currentPrice;
                }
                
            } catch (error) {
                console.error('Error loading historical prices:', error);
                price24hAgo = currentPrice;
            }
        }

        function startPriceListener() {
            if (priceListener) {
                priceListener();
            }
            
            priceListener = db.collection('settings').doc('currentPrice')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        currentPrice = doc.data().price;
                        updateUserInterface();
                        updateMarketDisplay();
                    }
                });
        }

        function updateMarketDisplay() {
            const changeAmount = currentPrice - price24hAgo;
            const changePercent = price24hAgo !== 0 ? (changeAmount / price24hAgo) * 100 : 0;
            
            const srcNgnElement = document.getElementById('srcNgnValue');
            const srcNgnChange = document.getElementById('srcNgnChange');
            
            srcNgnElement.textContent = `₦${currentPrice.toFixed(2)}`;
            
            const isPositive = changeAmount >= 0;
            const arrowIcon = isPositive ? 'fa-arrow-up' : 'fa-arrow-down';
            const changeClass = isPositive ? 'positive' : 'negative';
            
            srcNgnChange.innerHTML = `
                <i class="fas ${arrowIcon}"></i>
                <span class="${changeClass}">₦${Math.abs(changeAmount).toFixed(2)} (${changePercent.toFixed(2)}%)</span>
            `;
            
            const marketCap = totalCoinsInEcosystem * currentPrice;
            document.getElementById('marketCap').textContent = `₦${marketCap.toFixed(2)}`;
        }

        // =============================================
        // USER INTERFACE UPDATES
        // =============================================
        function updateUserInterface() {
            if (!currentUserID || !currentUserData) return;
            
            const tokenBalance = currentUserData.tokenUnits || 0;
            document.getElementById('totalBalance').textContent = `SRC ${tokenBalance.toFixed(2)}`;
            
            updateMarketDisplay();
            updateProfileModal();
        }

        function updateProfileModal() {
            if (!currentUserData) return;
            
            document.getElementById('profileWalletID').textContent = currentUserID;
            document.getElementById('profileSRCBalance').textContent = `${(currentUserData.tokenUnits || 0).toFixed(4)} SRC`;
            document.getElementById('profileNGNValue').textContent = `₦${((currentUserData.tokenUnits || 0) * currentPrice).toFixed(2)}`;
        }

        // =============================================
        // MODAL FUNCTIONS
        // =============================================
        function showP2PModal() {
            if (!currentUserID) {
                showNotification('Please login first', 'error');
                return;
            }
            document.getElementById('p2pModal').style.display = 'flex';
        }

        function showSellModal() {
            if (!currentUserID) {
                showNotification('Please login first', 'error');
                return;
            }
            document.getElementById('sellModal').style.display = 'flex';
            document.getElementById('sellCurrentPrice').textContent = `₦${currentPrice.toFixed(2)} per SRC`;
            calculateSell();
        }

        function showSendModal() {
            if (!currentUserID) {
                showNotification('Please login first', 'error');
                return;
            }
            document.getElementById('sendModal').style.display = 'flex';
            calculateSend();
        }

        function showProfile() {
            if (!currentUserID) {
                showNotification('Please login first', 'error');
                return;
            }
            updateProfileModal();
            document.getElementById('profileModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Reset send button if closing send modal
            if (modalId === 'sendModal') {
                resetSendButton();
            }
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal-overlay');
            modals.forEach(modal => modal.style.display = 'none');
            resetSendButton();
        }

        // =============================================
        // BUY FUNCTIONS (kept for reference but not used)
        // =============================================
        function calculateBuy() {
            const amount = parseFloat(document.getElementById('buyAmount').value) || 0;
            const BUY_FEE = 50;
            
            if (amount <= 0) {
                document.getElementById('buyGetAmount').textContent = '0 SRC';
                document.getElementById('buyTotalAmount').textContent = '₦0.00';
                return;
            }
            
            const getSRC = (amount - BUY_FEE) / currentPrice;
            const totalAmount = amount;
            
            document.getElementById('buyGetAmount').textContent = `${getSRC.toFixed(4)} SRC`;
            document.getElementById('buyTotalAmount').textContent = `₦${totalAmount.toFixed(2)}`;
        }

        async function submitBuyRequest() {
            const amount = parseFloat(document.getElementById('buyAmount').value) || 0;
            const BUY_FEE = 50;
            
            if (amount < 100) {
                showNotification('Minimum purchase amount is ₦100', 'error');
                return;
            }
            
            const getSRC = (amount - BUY_FEE) / currentPrice;
            
            const message = 
                `🛒 BUY REQUEST - SILRAN COIN\n\n` +
                `👤 Wallet ID: ${currentUserID}\n` +
                `💰 Amount: ₦${amount.toFixed(2)}\n` +
                `💸 Buy Fee: ₦${BUY_FEE}\n` +
                `🪙 Will Receive: ${getSRC.toFixed(4)} SRC\n` +
                `🔢 Reference: BUY-${currentUserID}\n` +
                `⏰ Time: ${new Date().toLocaleString()}`;
            
            try {
                await sendTelegramMessage(message);
                
                document.getElementById('buyAmount').value = '';
                closeModal('buyModal');
                
                showNotification('Buy request submitted! We will process your SRC within 24 hours.', 'success', 8000);
                
            } catch (error) {
                console.error('Error submitting buy request:', error);
                showNotification('Error submitting request. Please try again.', 'error');
            }
        }

        // =============================================
        // SELL FUNCTIONS WITH UPDATED ₦1,000 FEE
        // =============================================
        function calculateSell() {
            const tokenUnits = parseFloat(document.getElementById('sellTokenUnits').value) || 0;
            const SELL_FEE = 1000; // UPDATED: Now ₦1,000 fixed fee
            const MIN_WITHDRAWAL = 5000; // UPDATED: Minimum ₦5,000 payout (since fee is higher)
            
            if (tokenUnits <= 0) {
                document.getElementById('sellGrossValue').textContent = '₦0.00';
                document.getElementById('sellNetPayout').textContent = '₦0.00';
                return;
            }
            
            const grossValue = tokenUnits * currentPrice;
            const netPayout = grossValue - SELL_FEE;
            
            document.getElementById('sellGrossValue').textContent = `₦${grossValue.toFixed(2)}`;
            document.getElementById('sellNetPayout').textContent = `₦${netPayout.toFixed(2)}`;
            
            const button = document.getElementById('sellButton');
            if (netPayout < MIN_WITHDRAWAL) {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Below Minimum (₦5,000)';
            } else {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-check-circle"></i> Submit Sell Request';
            }
        }

        async function submitSellRequest() {
            const tokenUnits = parseFloat(document.getElementById('sellTokenUnits').value) || 0;
            const email = document.getElementById('sellEmail').value.trim();
            const accountNumber = document.getElementById('sellAccountNumber').value.trim();
            const bankName = document.getElementById('sellBankName').value.trim();
            const SELL_FEE = 1000; // UPDATED: ₦1,000 fixed fee
            const MIN_WITHDRAWAL = 5000; // UPDATED: Minimum ₦5,000 payout
            
            if (!tokenUnits || tokenUnits <= 0) {
                showNotification('Please enter valid token amount', 'error');
                return;
            }
            
            if (!email || !email.includes('@')) {
                showNotification('Please enter valid email address', 'error');
                return;
            }
            
            if (!accountNumber || accountNumber.length < 10) {
                showNotification('Please enter valid account number', 'error');
                return;
            }
            
            if (!bankName) {
                showNotification('Please enter bank name', 'error');
                return;
            }
            
            if (tokenUnits > currentUserData.tokenUnits) {
                showNotification('Insufficient SRC balance', 'error');
                return;
            }
            
            const grossValue = tokenUnits * currentPrice;
            const netPayout = grossValue - SELL_FEE;
            
            if (netPayout < MIN_WITHDRAWAL) {
                showNotification(`Minimum payout is ₦${MIN_WITHDRAWAL.toFixed(2)} after ₦1,000 fee`, 'error');
                return;
            }
            
            const message = 
                `💰 SELL REQUEST - SILRAN COIN\n\n` +
                `👤 Wallet ID: ${currentUserID}\n` +
                `📧 Email: ${email}\n` +
                `🪙 Token Units: ${tokenUnits.toFixed(4)} SRC\n` +
                `💵 Gross Value: ₦${grossValue.toFixed(2)}\n` +
                `💸 Sell Fee: ₦${SELL_FEE} (Fixed)\n` +
                `💵 Net Payout: ₦${netPayout.toFixed(2)}\n` +
                `🏦 Bank: ${bankName}\n` +
                `🔢 Account: ${accountNumber}\n` +
                `⏰ Time: ${new Date().toLocaleString()}`;
            
            try {
                await sendTelegramMessage(message);
                
                document.getElementById('sellTokenUnits').value = '';
                document.getElementById('sellEmail').value = '';
                document.getElementById('sellAccountNumber').value = '';
                document.getElementById('sellBankName').value = '';
                closeModal('sellModal');
                
                showNotification('Sell request submitted! Payment will be processed within 24 hours.', 'success', 8000);
                
            } catch (error) {
                console.error('Error submitting sell request:', error);
                showNotification('Error submitting request. Please try again.', 'error');
            }
        }

        // =============================================
        // SEND FUNCTIONS (calculate only)
        // =============================================
        function calculateSend() {
            const amount = parseFloat(document.getElementById('transferAmount').value) || 0;
            const TRANSFER_FEE = 0.02;
            
            if (amount <= 0) {
                document.getElementById('sendNetAmount').textContent = '0 SRC';
                return;
            }
            
            const fee = amount * TRANSFER_FEE;
            const netAmount = amount - fee;
            
            document.getElementById('sendNetAmount').textContent = `${netAmount.toFixed(4)} SRC`;
        }

        // =============================================
        // UTILITY FUNCTIONS
        // =============================================
        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showNotification('Failed to copy. Please copy manually.', 'error');
            });
        }

        function openTwitter() {
            window.open('https://x.com/silrancoin?s=20', '_blank');
        }

        async function sendTelegramMessage(message) {
            try {
                const response = await fetch(
                    `https://api.telegram.org/bot${telegramBotToken}/sendMessage?chat_id=${telegramChatId}&text=${encodeURIComponent(message)}`
                );
                return await response.json();
            } catch (error) {
                console.error('Telegram error:', error);
                throw error;
            }
        }

        // =============================================
        // BOTTOM NAVIGATION
        // =============================================
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                const text = this.querySelector('span').textContent;
                if (text === 'Home') {
                    // Already on home
                } else {
                    showNotification(`"${text}" feature coming soon!`, 'info');
                }
            });
        });

        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.style.display = 'none';
                resetSendButton();
            }
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && event.target.classList.contains('input-field')) {
                event.preventDefault();
            }
            
            // Keyboard shortcuts for search
            if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
                event.preventDefault();
                focusSearch();
            }
            
            if (event.key === 'Escape') {
                if (document.getElementById('searchResultsView').style.display === 'flex') {
                    closeSearchView();
                }
            }
        });
    </script>
</body>
</html>