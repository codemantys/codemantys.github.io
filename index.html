<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silranus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts for Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs - UPDATED WITH AUTH -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            query, 
            where, 
            orderBy,
            doc,
            setDoc,
            getDoc,
            updateDoc,
            deleteDoc,
            arrayUnion,
            arrayRemove,
            increment,
            limit
        } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        
        // Firebase Auth imports
        import { 
            getAuth, 
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            sendEmailVerification,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAhER480MhdEKF9yOwkZpEUm_rcqDiP8Es",
            authDomain: "silranex-36547.firebaseapp.com",
            projectId: "silranex-36547",
            storageBucket: "silranex-36547.firebasestorage.app",
            messagingSenderId: "753466124744",
            appId: "1:753466124744:web:026955aed50a531d72b8fd"
        };        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // Make available globally
        window.db = db;
        window.auth = auth;
        window.getFirestoreFunctions = { 
            collection, addDoc, getDocs, query, where, orderBy, doc, setDoc, getDoc,
            updateDoc, deleteDoc, arrayUnion, arrayRemove, increment, limit
        };
        window.getAuthFunctions = { 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            sendEmailVerification,
            updateProfile
        };
    </script>    <style>
        /* Silran Coin Theme Variables */
        :root {
            --bg-color: #000000;
            --card-bg: #000000;
            --accent-orange: #f39200;
            --accent-blue: #1d9bf0;
            --text-main: #ffffff;
            --text-dim: #71767b;
            --border-color: #2f3336;
            --gradient-orange: linear-gradient(45deg, #f39200, #ffad33);
            --gradient-blue: linear-gradient(45deg, #00a2ff, #4dc3ff);
            --success-green: #00ba7c;
            --error-red: #f4212e;
            --warning-yellow: #ffd400;
        }        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.5;
            min-height: 100vh;
        }        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }        /* Notification System Styles */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }        .notification {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            transition: all 0.3s ease;
            max-width: 100%;
        }        .notification.hiding {
            animation: slideOutRight 0.3s ease-out;
            opacity: 0;
            transform: translateX(100%);
        }        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }        .notification-icon {
            font-size: 20px;
            flex-shrink: 0;
            margin-top: 2px;
        }        .notification-content {
            flex: 1;
        }        .notification-title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--text-main);
        }        .notification-message {
            font-size: 14px;
            color: var(--text-dim);
            line-height: 1.4;
        }        .notification-close {
            background: none;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            flex-shrink: 0;
        }        .notification-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-main);
        }        .notification.success {
            border-left: 4px solid var(--success-green);
        }        .notification.success .notification-icon {
            color: var(--success-green);
        }        .notification.error {
            border-left: 4px solid var(--error-red);
        }        .notification.error .notification-icon {
            color: var(--error-red);
        }        .notification.warning {
            border-left: 4px solid var(--warning-yellow);
        }        .notification.warning .notification-icon {
            color: var(--warning-yellow);
        }        .notification.info {
            border-left: 4px solid var(--accent-blue);
        }        .notification.info .notification-icon {
            color: var(--accent-blue);
        }        /* Action Notification (for confirmations) */
        .action-notification {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }        .action-notification-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 10px;
        }        .action-notification-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }        .action-notification-btn.confirm {
            background: var(--gradient-orange);
            color: white;
        }        .action-notification-btn.confirm:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(243, 146, 0, 0.3);
        }        .action-notification-btn.cancel {
            background-color: var(--border-color);
            color: var(--text-main);
        }        .action-notification-btn.cancel:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }        /* News Coming Soon Modal */
        .news-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }        .news-modal-content {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            border: 2px solid var(--accent-orange);
            text-align: center;
            box-shadow: 0 10px 30px rgba(243, 146, 0, 0.3);
        }        .news-icon {
            font-size: 60px;
            color: var(--accent-orange);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }        .news-modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-orange);
            margin-bottom: 15px;
        }        .news-modal-message {
            font-size: 16px;
            color: var(--text-main);
            line-height: 1.5;
            margin-bottom: 25px;
        }        .news-modal-close {
            background: var(--gradient-orange);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }        .news-modal-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 146, 0, 0.3);
        }        /* Link styles in posts */
        .post-text a,
        .bookmarked-post-text a,
        .comment-text a {
            color: var(--accent-orange);
            text-decoration: none;
            word-break: break-all;
        }        .post-text a:hover,
        .bookmarked-post-text a:hover,
        .comment-text a:hover {
            text-decoration: underline;
            color: var(--accent-blue);
        }        /* Refresh Banner */
        .refresh-banner {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-orange);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 20px rgba(243, 146, 0, 0.4);
            animation: slideDown 0.3s ease-out;
            font-weight: 600;
            max-width: 90%;
        }        @keyframes slideDown {
            from {
                top: -100px;
                opacity: 0;
            }
            to {
                top: 80px;
                opacity: 1;
            }
        }        @keyframes slideUp {
            from {
                top: 80px;
                opacity: 1;
            }
            to {
                top: -100px;
                opacity: 0;
            }
        }        .refresh-banner:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 25px rgba(243, 146, 0, 0.6);
        }        .refresh-count {
            background: white;
            color: var(--accent-orange);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }        /* Login/Signup Screens */
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background-color: var(--bg-color);
        }        .auth-box {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }        .auth-logo .logo {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent-orange);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }        .auth-logo p {
            color: var(--text-dim);
            font-size: 14px;
        }        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
        }        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            color: var(--text-dim);
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s;
        }        .auth-tab.active {
            color: var(--accent-orange);
            border-bottom: 2px solid var(--accent-orange);
        }        .auth-form {
            display: none;
        }        .auth-form.active {
            display: block;
        }        .form-group {
            margin-bottom: 20px;
        }        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-main);
            font-size: 14px;
            font-weight: 500;
        }        .optional-text {
            color: var(--text-dim);
            font-size: 12px;
            font-weight: normal;
        }        .form-input {
            width: 100%;
            padding: 14px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-main);
            font-size: 16px;
            transition: all 0.3s;
        }        .form-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 2px rgba(243, 146, 0, 0.2);
        }        .form-input.error {
            border-color: var(--error-red);
        }        .error-message {
            color: var(--error-red);
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }        .form-requirements {
            color: var(--text-dim);
            font-size: 12px;
            margin-top: 5px;
        }        /* Avatar Selection */
        .avatar-selection {
            margin: 20px 0;
        }        .avatar-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }        .avatar-option {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            border: 3px solid transparent;
            background: var(--card-bg);
        }        .avatar-option:hover {
            transform: scale(1.05);
            border-color: var(--accent-orange);
        }        .avatar-option.selected {
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 3px rgba(243, 146, 0, 0.3);
        }        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }        .avatar-info {
            color: var(--text-dim);
            font-size: 12px;
            text-align: center;
            margin-top: 8px;
        }        .auth-btn {
            width: 100%;
            background: var(--gradient-orange);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 146, 0, 0.3);
        }        .auth-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }        .auth-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--text-dim);
            font-size: 14px;
        }        .auth-link {
            color: var(--accent-orange);
            text-decoration: none;
            cursor: pointer;
            font-weight: 600;
        }        .auth-link:hover {
            text-decoration: underline;
        }        /* Profile Setup Screen (NEW) */
        .profile-setup-screen {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background-color: var(--bg-color);
        }        .profile-setup-box {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }        .profile-setup-logo {
            text-align: center;
            margin-bottom: 30px;
        }        .profile-setup-logo .logo {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent-orange);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }        .profile-setup-logo p {
            color: var(--text-dim);
            font-size: 14px;
        }        .profile-setup-form {
            margin-top: 20px;
        }        /* App Interface (Hidden Initially) */
        .app-interface {
            display: none;
        }        /* Header */
        header {
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background-color: var(--card-bg);
            z-index: 100;
            backdrop-filter: blur(10px);
        }        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-orange);
            display: flex;
            align-items: center;
            gap: 8px;
        }        .logo i {
            font-size: 24px;
        }        .header-icons {
            display: flex;
            gap: 20px;
            align-items: center;
            position: relative;
        }        .icon-btn {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            position: relative;
            background: rgba(255, 255, 255, 0.05);
        }        .icon-btn:hover {
            background-color: var(--accent-orange);
            color: white;
            transform: translateY(-2px);
        }        .icon-btn.has-notifications::after {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background-color: var(--error-red);
            border-radius: 50%;
            border: 2px solid var(--card-bg);
        }        .icon-btn.has-unread::after {
            content: attr(data-count);
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--error-red);
            color: white;
            font-size: 10px;
            font-weight: bold;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--card-bg);
        }        /* Main Layout */
        .main-layout {
            display: flex;
            gap: 30px;
            padding: 20px 0 80px 0;
        }        /* Left Sidebar */
        .sidebar {
            width: 250px;
            flex-shrink: 0;
            display: none;
        }        .nav-menu {
            position: sticky;
            top: 80px;
        }        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 12px;
            margin-bottom: 5px;
            transition: all 0.2s;
            font-size: 16px;
            font-weight: 500;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }        .nav-item:hover {
            background-color: rgba(243, 146, 0, 0.1);
            border-color: var(--accent-orange);
            transform: translateX(5px);
        }        .nav-item.active {
            color: var(--accent-orange);
            background: rgba(243, 146, 0, 0.15);
            border-color: var(--accent-orange);
        }        /* News Button Styles (Replaces Bot Button) */
        .news-btn {
            width: 100%;
            background: var(--gradient-orange);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }        .news-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 146, 0, 0.3);
        }        /* Main Content */
        .main-content {
            flex: 1;
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: 30px;
        }        /* Instagram Story Cards - RECTANGULAR PREVIEW CARDS */
        .stories-container {
            display: flex;
            gap: 10px;
            padding: 15px 0;
            overflow-x: auto;
            scrollbar-width: none;
            height: 175px;
            align-items: center;
            margin-bottom: 20px;
        }        .stories-container::-webkit-scrollbar {
            display: none;
        }        .story-item {
            position: relative;
            min-width: 110px;
            height: 160px;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 0.2s;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }        .story-item:hover {
            transform: scale(1.02);
            border-color: var(--accent-orange);
            box-shadow: 0 4px 12px rgba(243, 146, 0, 0.2);
        }        /* Profile Story Card */
        .story-item.profile-card {
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-blue) 100%);
        }        /* Updated Social Media Card Styles */
        .story-item.social-card {
            border: 1px solid rgba(255, 255, 255, 0.3);
        }        /* YouTube Card */
        .story-card-2 {
            background: linear-gradient(135deg, #FF0000 0%, #FF0000 50%, #CC0000 100%);
        }        /* Instagram Card */
        .story-card-3 {
            background: linear-gradient(135deg, #833AB4 0%, #E1306C 50%, #F77737 100%);
        }        /* Facebook Card */
        .story-card-4 {
            background: linear-gradient(135deg, #1877F2 0%, #0A5DC2 100%);
        }        /* X (Twitter) Card */
        .story-card-5 {
            background: linear-gradient(135deg, #000000 0%, #1DA1F2 100%);
        }        /* Telegram Card (Replaces Spotify) */
        .story-card-6 {
            background: linear-gradient(135deg, #0088cc 0%, #00a8ff 100%);
        }        /* Discord Card (Replaces Netflix) */
        .story-card-7 {
            background: linear-gradient(135deg, #5865F2 0%, #7289DA 100%);
        }        /* The Main Preview Image */
        .story-preview-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.7;
        }        /* Dark overlay for text readability */
        .story-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0) 40%, rgba(0,0,0,0.8) 100%);
            z-index: 1;
        }        /* Small Profile Circle on top of card */
        .story-profile-circle {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--accent-orange);
            z-index: 2;
            overflow: hidden;
            background: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }        .story-profile-circle.social-border {
            border-color: white;
            background: rgba(0, 0, 0, 0.7);
        }        .story-profile-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }        .story-profile-circle i {
            font-size: 14px;
            color: white;
        }        /* Username at bottom of card */
        .story-username {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            z-index: 2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 1px 4px rgba(0,0,0,0.8);
        }        /* Social Card Main Icon */
        .social-main-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            color: rgba(255, 255, 255, 0.9);
            z-index: 1;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }        /* Entertainment Categories */
        .entertainment-categories {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 15px 0;
            margin-bottom: 20px;
            scrollbar-width: none;
        }        .category-btn {
            padding: 8px 16px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }        .category-btn:hover {
            background-color: rgba(243, 146, 0, 0.1);
            border-color: var(--accent-orange);
        }        .category-btn.active {
            background: var(--gradient-orange);
            border-color: transparent;
            color: white;
        }        /* Posts */
        .post {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
            position: relative;
        }        .post:hover {
            border-color: var(--accent-orange);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 146, 0, 0.1);
        }        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }        .post-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-orange);
        }        .user-info h3 {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-main);
        }        .user-info p {
            color: var(--text-dim);
            font-size: 15px;
        }        .post-content {
            margin-bottom: 15px;
        }        .post-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-orange);
            margin-bottom: 10px;
            line-height: 1.3;
        }        .post-text {
            font-size: 15px;
            margin-bottom: 15px;
            line-height: 1.5;
            color: var(--text-main);
        }        .post-image {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            max-height: 500px;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }        .post-image.loaded {
            opacity: 1;
        }        .youtube-video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }        .youtube-video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
        }        .post-actions {
            display: flex;
            justify-content: space-around;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }        .post-action {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dim);
            background: none;
            border: none;
            font-size: 15px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
        }        .post-action:hover {
            background-color: rgba(243, 146, 0, 0.1);
            color: var(--accent-orange);
        }        .post-action.liked {
            color: #f91880;
        }        .post-action.bookmarked {
            color: var(--warning-yellow);
        }        .post-action.delete {
            color: var(--error-red);
        }        .post-action i {
            font-size: 20px;
        }        .post-owner-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }        .post-owner-action {
            background: none;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }        .post-owner-action:hover {
            background-color: rgba(255, 77, 77, 0.1);
            color: var(--error-red);
        }        /* ENHANCED COMMENTS SECTION */
        .comments-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--text-dim);
            font-size: 14px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.2s;
        }        .comments-header:hover {
            background-color: rgba(243, 146, 0, 0.1);
            color: var(--accent-orange);
        }        .comments-header i {
            transition: transform 0.3s;
            font-size: 12px;
        }        .comments-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding-right: 5px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-orange) var(--bg-color);
        }        .comments-list::-webkit-scrollbar {
            width: 6px;
        }        .comments-list::-webkit-scrollbar-track {
            background: var(--bg-color);
            border-radius: 10px;
        }        .comments-list::-webkit-scrollbar-thumb {
            background: var(--accent-orange);
            border-radius: 10px;
        }        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.03);
            position: relative;
            transition: all 0.2s;
            border: 1px solid transparent;
        }        .comment:hover {
            background-color: rgba(243, 146, 0, 0.05);
            border-color: rgba(243, 146, 0, 0.3);
        }        .comment-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            border: 2px solid var(--accent-orange);
        }        .comment-content {
            flex: 1;
            min-width: 0;
        }        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }        .comment-username {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 6px;
        }        .comment-verified {
            color: var(--accent-orange);
            font-size: 12px;
        }        .comment-time {
            color: var(--text-dim);
            font-size: 12px;
            white-space: nowrap;
        }        .comment-text {
            font-size: 14px;
            line-height: 1.4;
            color: var(--text-main);
            margin-bottom: 8px;
            word-break: break-word;
        }        .comment-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }        .comment-like-btn {
            background: none;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            padding: 4px 8px;
            border-radius: 12px;
        }        .comment-like-btn:hover {
            background-color: rgba(249, 24, 128, 0.1);
            color: #f91880;
        }        .comment-like-btn.liked {
            color: #f91880;
        }        .comment-like-count {
            font-size: 11px;
        }        .comment-reply-btn {
            background: none;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            padding: 4px 8px;
            border-radius: 12px;
        }        .comment-reply-btn:hover {
            background-color: rgba(243, 146, 0, 0.1);
            color: var(--accent-orange);
        }        .comment-delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 6px;
            font-size: 11px;
            transition: all 0.2s;
            display: none;
        }        .comment:hover .comment-delete-btn {
            display: block;
        }        .comment-delete-btn:hover {
            background-color: rgba(244, 33, 46, 0.8);
            color: white;
        }        .add-comment {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            padding: 12px;
            background-color: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }        .comment-input-container {
            flex: 1;
            position: relative;
        }        .comment-input {
            width: 100%;
            padding: 10px 15px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-main);
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
            padding-right: 60px;
            font-family: inherit;
        }        .comment-input:focus {
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 2px rgba(243, 146, 0, 0.2);
        }        .comment-char-counter {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 11px;
            color: var(--text-dim);
            pointer-events: none;
        }        .comment-char-counter.warning {
            color: var(--warning-yellow);
        }        .comment-char-counter.error {
            color: var(--error-red);
        }        .comment-submit {
            background: var(--gradient-orange);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }        .comment-submit:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(243, 146, 0, 0.4);
        }        .comment-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--border-color);
        }        .no-comments {
            text-align: center;
            color: var(--text-dim);
            font-size: 14px;
            padding: 25px 20px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.02);
            border: 1px dashed var(--border-color);
        }        .no-comments i {
            font-size: 32px;
            margin-bottom: 10px;
            opacity: 0.5;
        }        /* Nested Replies (for future use) */
        .comment-replies {
            margin-left: 48px;
            margin-top: 8px;
            padding-left: 12px;
            border-left: 2px solid rgba(243, 146, 0, 0.3);
        }        /* Loading comments animation */
        .comments-loading {
            display: flex;
            justify-content: center;
            padding: 20px;
        }        /* Right Sidebar */
        .right-sidebar {
            width: 350px;
            flex-shrink: 0;
            display: none;
        }        .widget {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }        .widget-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 15px;
            color: var(--accent-orange);
        }        .trending-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }        .trending-item:hover {
            background-color: rgba(243, 146, 0, 0.05);
        }        .trending-item:last-child {
            border-bottom: none;
        }        .trending-category {
            color: var(--text-dim);
            font-size: 13px;
        }        .trending-topic {
            font-weight: 700;
            font-size: 15px;
            margin: 5px 0;
            color: var(--text-main);
        }        .trending-count {
            color: var(--text-dim);
            font-size: 13px;
        }        /* Bottom Navigation (Mobile) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }        .nav-icon {
            color: var(--text-dim);
            font-size: 24px;
            padding: 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.05);
        }        .nav-icon:hover {
            background-color: var(--accent-orange);
            color: white;
            transform: translateY(-2px);
        }        .nav-icon.active {
            color: var(--accent-orange);
            background: rgba(243, 146, 0, 0.15);
            border: 1px solid var(--accent-orange);
        }        /* News Icon for Mobile (Replaces Bot) */
        .news-icon-mobile {
            background: var(--gradient-orange);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-top: -20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(243, 146, 0, 0.4);
            border: none;
        }        .news-icon-mobile:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(243, 146, 0, 0.6);
        }        /* Profile Modal */
        .profile-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }        .profile-modal-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
        }        .profile-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }        .profile-modal-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-orange);
        }        .profile-close-btn {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }        .profile-close-btn:hover {
            background-color: rgba(243, 146, 0, 0.1);
        }        .profile-modal-body {
            padding: 20px;
        }        .profile-header {
            text-align: center;
            margin-bottom: 20px;
        }        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-orange);
            margin: 0 auto 15px auto;
        }        .profile-username-display {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-orange);
            margin-bottom: 5px;
        }        .profile-email-display {
            color: var(--text-dim);
            font-size: 14px;
        }        .profile-form-group {
            margin-bottom: 20px;
        }        .profile-form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-main);
            font-size: 14px;
            font-weight: 500;
        }        .profile-form-input {
            width: 100%;
            padding: 12px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-main);
            font-size: 16px;
            transition: border-color 0.2s;
        }        .profile-form-input:focus {
            outline: none;
            border-color: var(--accent-orange);
        }        .profile-form-input:read-only {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-dim);
            cursor: not-allowed;
        }        .profile-modal-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 25px;
        }        .profile-save-btn {
            background: var(--gradient-orange);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }        .profile-save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 146, 0, 0.3);
        }        .profile-save-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }        .profile-logout-btn {
            background: transparent;
            color: var(--error-red);
            border: 1px solid var(--error-red);
            padding: 14px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }        .profile-logout-btn:hover {
            background-color: rgba(244, 33, 46, 0.1);
        }        /* Bookmarks Floating Button */
        .bookmark-floating-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background: var(--gradient-orange);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 99;
            box-shadow: 0 4px 20px rgba(243, 146, 0, 0.4);
            transition: all 0.3s;
        }        .bookmark-floating-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 6px 25px rgba(243, 146, 0, 0.6);
        }        .bookmark-floating-btn.has-bookmarks::after {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 12px;
            height: 12px;
            background-color: var(--error-red);
            border-radius: 50%;
            border: 2px solid var(--card-bg);
        }        /* Bookmarks Modal */
        .bookmarks-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }        .bookmarks-modal-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            border: 2px solid var(--accent-orange);
            display: flex;
            flex-direction: column;
        }        .bookmarks-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 2px solid var(--accent-orange);
            background: rgba(243, 146, 0, 0.1);
        }        .bookmarks-modal-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-orange);
            display: flex;
            align-items: center;
            gap: 10px;
        }        .bookmarks-modal-header h2 i {
            font-size: 22px;
        }        .bookmarks-close-btn {
            background: none;
            border: none;
            color: var(--accent-orange);
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }        .bookmarks-close-btn:hover {
            background-color: rgba(243, 146, 0, 0.1);
        }        .bookmarks-modal-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }        .no-bookmarks {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-dim);
            font-size: 16px;
        }        .no-bookmarks i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--accent-orange);
            opacity: 0.5;
        }        .bookmarked-post {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(243, 146, 0, 0.3);
            position: relative;
        }        .bookmarked-post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }        .bookmarked-post-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }        .bookmarked-post-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-orange);
        }        .bookmarked-post-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-orange);
        }        .bookmarked-post-info p {
            color: var(--text-dim);
            font-size: 12px;
        }        .remove-bookmark-btn {
            background: none;
            border: none;
            color: var(--error-red);
            cursor: pointer;
            font-size: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }        .remove-bookmark-btn:hover {
            background-color: rgba(244, 33, 46, 0.1);
        }        .bookmarked-post-content {
            margin-bottom: 10px;
        }        .bookmarked-post-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 10px;
            color: var(--text-main);
        }        .bookmarked-post-image {
            width: 100%;
            border-radius: 8px;
            max-height: 200px;
            object-fit: cover;
            border: 1px solid var(--border-color);
        }        .bookmarked-post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid rgba(243, 146, 0, 0.1);
            font-size: 12px;
            color: var(--text-dim);
        }        /* Character Counter Styles */
        .char-counter {
            text-align: right;
            margin-top: 5px;
            font-size: 12px;
            color: var(--text-dim);
        }        .char-counter.warning {
            color: var(--warning-yellow);
        }        .char-counter.error {
            color: var(--error-red);
        }        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--text-dim);
            border-top-color: var(--accent-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }        @keyframes spin {
            to { transform: rotate(360deg); }
        }        /* Performance Optimizations */
        .lazy-image {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }        .lazy-image.loaded {
            opacity: 1;
        }        /* Bookmark Status Indicators */
        .bookmark-saving {
            animation: pulse 1.5s infinite;
        }        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }        .bookmark-saved {
            animation: bounce 0.5s;
        }        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }        /* Social Media Modal */
        .social-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }        .social-modal-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
        }        .social-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }        .social-modal-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-orange);
        }        .social-close-btn {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }        .social-close-btn:hover {
            background-color: rgba(243, 146, 0, 0.1);
        }        .social-modal-body {
            padding: 20px;
        }        .social-header {
            text-align: center;
            margin-bottom: 20px;
        }        .social-icon-large {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--accent-orange);
        }        .social-platform-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-orange);
            margin-bottom: 5px;
        }        .social-description {
            color: var(--text-dim);
            font-size: 14px;
        }        .social-visit-btn {
            background: var(--gradient-orange);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            max-width: 250px;
            margin: 30px auto 0;
            transition: all 0.2s;
        }        .social-visit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(243, 146, 0, 0.4);
        }        /* Responsive Design */
        @media (min-width: 768px) {
            .sidebar {
                display: block;
            }
            
            .bottom-nav {
                display: none;
            }
            
            .main-layout {
                padding-top: 30px;
            }
            
            .bookmark-floating-btn {
                bottom: 30px;
                right: 30px;
                width: 70px;
                height: 70px;
                font-size: 28px;
            }
            
            .stories-container {
                height: 175px;
            }
            
            .story-item {
                min-width: 120px;
                height: 170px;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }        @media (min-width: 1024px) {
            .right-sidebar {
                display: block;
            }
        }        @media (max-width: 767px) {
            .main-layout {
                flex-direction: column;
                gap: 0;
            }
            
            .main-content {
                width: 100%;
                max-width: 100%;
                padding: 0 10px;
            }
            
            .post {
                border-radius: 12px;
                margin: 10px 0;
            }
            
            .stories-container {
                height: 160px;
                padding-left: 10px;
                padding-right: 10px;
            }
            
            .story-item {
                min-width: 100px;
                height: 150px;
            }
            
            .entertainment-categories {
                padding-left: 10px;
                padding-right: 10px;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .auth-box {
                padding: 30px 20px;
            }
            
            .bookmark-floating-btn {
                bottom: 80px;
                right: 15px;
                width: 55px;
                height: 55px;
                font-size: 22px;
            }
            
            .refresh-banner {
                top: 70px;
                padding: 10px 20px;
                font-size: 14px;
            }
            
            /* Mobile optimizations for comments */
            .comment {
                padding: 10px;
            }
            
            .comment-avatar {
                width: 32px;
                height: 32px;
            }
            
            .comment-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 2px;
            }
            
            .comment-time {
                font-size: 11px;
            }
            
            .add-comment {
                padding: 10px;
            }
            
            .comment-submit {
                width: 36px;
                height: 36px;
            }
        }
    </style>
</head>
<body>
    <!-- News Coming Soon Modal -->
    <div class="news-modal-overlay" id="newsModal">
        <div class="news-modal-content">
            <div class="news-icon">
                <i class="fas fa-newspaper"></i>
            </div>
            <h2 class="news-modal-title">Coming Soon</h2>
            <p class="news-modal-message">
                News feature is coming soon! 
                Stay tuned for the latest updates, breaking news, and curated content.
            </p>
            <button class="news-modal-close" id="closeNewsModal">
                Got it
            </button>
        </div>
    </div>    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>    <!-- Auth Screens -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-box">
            <div class="auth-logo">
                <div class="logo">
                    <i class="fas fa-coin"></i>
                    Silranus
                </div>
                <p>Simplified Digital Economy</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="signup">Sign Up</div>
            </div>
            
            <!-- Login Form -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="Enter your email" required>
                    <div class="error-message" id="loginEmailError"></div>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password" required>
                    <div class="error-message" id="loginPasswordError"></div>
                </div>
                
                <button type="submit" class="auth-btn" id="loginBtn">Log In</button>
                
                <div class="auth-footer">
                    <p>Don't have an account? <span class="auth-link" data-tab="signup">Sign up</span></p>
                </div>
            </form>
            
            <!-- Signup Form -->
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <label for="signupEmail">Email Address</label>
                    <input type="email" id="signupEmail" class="form-input" placeholder="Enter your email" required>
                    <div class="error-message" id="signupEmailError"></div>
                </div>
                
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" class="form-input" placeholder="Create a password (min. 6 characters)" required>
                    <div class="error-message" id="signupPasswordError"></div>
                    <div class="form-requirements">Password must be at least 6 characters long</div>
                </div>
                
                <div class="form-group">
                    <label for="signupConfirmPassword">Confirm Password</label>
                    <input type="password" id="signupConfirmPassword" class="form-input" placeholder="Confirm your password" required>
                    <div class="error-message" id="signupConfirmPasswordError"></div>
                </div>
                
                <button type="submit" class="auth-btn" id="signupBtn">Sign Up</button>
                
                <div class="auth-footer">
                    <p>Already have an account? <span class="auth-link" data-tab="login">Log in</span></p>
                </div>
            </form>
        </div>
    </div>    <!-- Profile Setup Screen (NEW) -->
    <div class="profile-setup-screen" id="profileSetupScreen">
        <div class="profile-setup-box">
            <div class="profile-setup-logo">
                <div class="logo">
                    <i class="fas fa-coin"></i>
                    Silranus
                </div>
                <p>Simplified Digital Economy</p>
            </div>
            
            <form class="profile-setup-form" id="profileSetupForm">
                <div class="form-group">
                    <label for="profileUsername">Username</label>
                    <input type="text" id="profileUsername" class="form-input" placeholder="Choose a username" required>
                    <div class="error-message" id="profileUsernameError"></div>
                    <div class="form-requirements">This will be your display name</div>
                </div>
                
                <!-- Avatar Selection -->
                <div class="avatar-selection">
                    <div class="avatar-title">
                        <span>Choose Your Avatar</span>
                        <span id="avatarRequired" style="color: var(--accent-orange); font-size: 12px;">*Required</span>
                    </div>
                    <div class="avatar-grid" id="avatarGrid">
                        <!-- Avatars will be loaded here -->
                    </div>
                    <div class="avatar-info">Select one avatar for your profile</div>
                    <div class="error-message" id="avatarError"></div>
                </div>
                
                <button type="submit" class="auth-btn" id="completeProfileBtn">Complete Profile</button>
            </form>
        </div>
    </div>    <!-- App Interface -->
    <div class="app-interface" id="appInterface">
        <div class="container">
            <header>
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-coin"></i>
                        Silranus
                    </div>
                    <div class="header-icons">
                        <a href="go:message" class="icon-btn">
                            <i class="far fa-envelope"></i>
                        </a>
                        <a href="go:wallet" class="icon-btn">
                            <i class="fas fa-wallet"></i>
                        </a>
                    </div>
                </div>
            </header>            <div class="main-layout">
                <!-- Left Sidebar -->
                <aside class="sidebar">
                    <div class="nav-menu">
                        <a href="go:home" class="nav-item active">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </a>
                        <a href="go:earn" class="nav-item">
                            <i class="fas fa-pickaxe"></i>
                            <span>Mine</span>
                        </a>
                        <a href="go:game" class="nav-item">
                            <i class="fas fa-gamepad"></i>
                            <span>Games</span>
                        </a>
                        <!-- News Button instead of Bot Button -->
                        <a href="go:news" class="news-btn">
                            <i class="fas fa-newspaper"></i>
                            <span>News</span>
                        </a>
                    </div>
                </aside>                <!-- Main Content -->
                <main class="main-content">
                    <!-- Instagram-style Rectangular Story Cards -->
                    <div class="stories-container" id="storiesContainer">
                        <!-- My Profile Card (First Card) -->
                        <div class="story-item profile-card" id="myProfileStory">
                            <div class="story-overlay"></div>
                            <div class="story-profile-circle" id="profileStoryAvatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="story-username">My Profile</div>
                        </div>                        <!-- YouTube Card -->
                        <div class="story-item social-card story-card-2" id="youtubeCard">
                            <i class="fab fa-youtube social-main-icon"></i>
                            <div class="story-overlay"></div>
                            <div class="story-profile-circle social-border">
                                <i class="fab fa-youtube"></i>
                            </div>
                            <div class="story-username">YouTube</div>
                        </div>                        <!-- Instagram Card -->
                        <div class="story-item social-card story-card-3" id="instagramCard">
                            <i class="fab fa-instagram social-main-icon"></i>
                            <div class="story-overlay"></div>
                            <div class="story-profile-circle social-border">
                                <i class="fab fa-instagram"></i>
                            </div>
                            <div class="story-username">Instagram</div>
                        </div>                        <!-- Facebook Card -->
                        <div class="story-item social-card story-card-4" id="facebookCard">
                            <i class="fab fa-facebook social-main-icon"></i>
                            <div class="story-overlay"></div>
                            <div class="story-profile-circle social-border">
                                <i class="fab fa-facebook"></i>
                            </div>
                            <div class="story-username">Facebook</div>
                        </div>                        <!-- X (Twitter) Card -->
                        <div class="story-item social-card story-card-5" id="twitterCard">
                            <i class="fab fa-twitter social-main-icon"></i>
                            <div class="story-overlay"></div>
                            <div class="story-profile-circle social-border">
                                <i class="fab fa-twitter"></i>
                            </div>
                            <div class="story-username">X (Twitter)</div>
                        </div>                        <!-- Telegram Card (Replaces Spotify) -->
                        <div class="story-item social-card story-card-6" id="telegramCard">
                            <i class="fab fa-telegram social-main-icon"></i>
                            <div class="story-overlay"></div>
                            <div class="story-profile-circle social-border">
                                <i class="fab fa-telegram"></i>
                            </div>
                            <div class="story-username">Telegram</div>
                        </div>                        <!-- Discord Card (Replaces Netflix) -->
                        <div class="story-item social-card story-card-7" id="discordCard">
                            <i class="fab fa-discord social-main-icon"></i>
                            <div class="story-overlay"></div>
                            <div class="story-profile-circle social-border">
                                <i class="fab fa-discord"></i>
                            </div>
                            <div class="story-username">Discord</div>
                        </div>
                    </div>                    <!-- Entertainment Categories -->
                    <div class="entertainment-categories">
                        <a href="go:earn" class="category-btn"> Mine</a>
                        <a href="go:game" class="category-btn"> Games</a>
                    </div>                    <!-- Posts Container -->
                    <div id="postsContainer">
                        <!-- Posts will be loaded dynamically from Firebase with caching -->
                    </div>
                </main>                <!-- Right Sidebar -->
                <aside class="right-sidebar">
                    <div class="widget">
                        <h3 class="widget-title">Coming Soon</h3>
                        <div class="trending-item">
                            <div class="trending-category">Live Charts</div>
                            <div class="trending-topic">Sponsored</div>
                            <div class="trending-count">charts</div>
                        </div>
                        <div class="trending-item">
                            <div class="trending-category">Games</div>
                            <div class="trending-topic">cloud games</div>
                            <div class="trending-count">sponsored</div>
                        </div>
                    </div>
                </aside>
            </div>            <!-- Bottom Navigation (Mobile) -->
            <nav class="bottom-nav">
                <a href="go:home" class="nav-icon active">
                    <i class="fas fa-home"></i>
                </a>
                <a href="go:discover" class="nav-icon">
                    <i class="fas fa-compass"></i>
                </a>
                <!-- News Icon for Mobile (Replaces Bot) -->
                <a href="go:news" class="news-icon-mobile">
                    <i class="fas fa-newspaper"></i>
                </a>
                <a href="go:earn" class="nav-icon">
                    <i class="fas fa-coins"></i>
                </a>
                <a href="go:game" class="nav-icon">
                    <i class="fas fa-gamepad"></i>
                </a>
            </nav>            <!-- Bookmarks Floating Button -->
            <button class="bookmark-floating-btn" id="bookmarkFloatingBtn">
                <i class="fas fa-bookmark"></i>
            </button>            <!-- Bookmarks Modal -->
            <div class="bookmarks-modal-overlay" id="bookmarksModal">
                <div class="bookmarks-modal-content">
                    <div class="bookmarks-modal-header">
                        <h2>
                            <i class="fas fa-bookmark"></i>
                            My Saved Posts
                        </h2>
                        <button class="bookmarks-close-btn" id="closeBookmarksModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="bookmarks-modal-body" id="bookmarksContainer">
                        <!-- Bookmarked posts will be loaded here -->
                    </div>
                </div>
            </div>            <!-- Social Media Links Modal -->
            <div class="social-modal-overlay" id="socialModal">
                <div class="social-modal-content">
                    <div class="social-modal-header">
                        <h2 id="socialModalTitle">Social Media</h2>
                        <button class="social-close-btn" id="closeSocialModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="social-modal-body">
                        <div class="social-header">
                            <div id="socialModalIcon" style="font-size: 60px; margin-bottom: 20px; color: var(--accent-orange);"></div>
                            <div class="social-platform-name" id="socialPlatformName">
                                Platform Name
                            </div>
                            <div class="social-description" id="socialDescription">
                                Click the button below to visit
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="social-visit-btn" id="visitSocialBtn">
                                <i class="fas fa-external-link-alt"></i>
                                Visit Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>            <!-- Profile Modal -->
            <div class="profile-modal-overlay" id="profileModal">
                <div class="profile-modal-content">
                    <div class="profile-modal-header">
                        <h2>My Profile</h2>
                        <button class="profile-close-btn" id="closeProfileModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="profile-modal-body">
                        <div class="profile-header">
                            <img src="" class="profile-avatar-large" alt="Your Profile" id="profileAvatarLarge">
                            <div class="profile-username-display" id="profileUsernameDisplay">User123</div>
                            <div class="profile-email-display" id="profileEmailDisplay">user@example.com</div>
                        </div>
                        
                        <div class="profile-modal-actions">
                            <button class="profile-logout-btn" id="logoutBtn">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>    <!-- The rest of your JavaScript code remains exactly the same -->
    <script>
        // =============================================
        // NOTIFICATION SYSTEM
        // =============================================
        class NotificationSystem {
            constructor() {
                this.container = document.getElementById('notificationContainer');
                this.notifications = [];
                this.nextId = 1;
                this.confirmCallback = null;
            }
            
            show(message, type = 'info', duration = 5000) {
                const id = this.nextId++;
                const notification = this.createNotification(id, message, type);
                
                this.container.appendChild(notification);
                this.notifications.push({ id, element: notification });
                
                // Auto remove after duration
                if (duration > 0) {
                    setTimeout(() => {
                        this.remove(id);
                    }, duration);
                }
                
                return id;
            }
            
            createNotification(id, message, type) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.id = `notification-${id}`;
                
                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle',
                    info: 'fas fa-info-circle'
                };
                
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="${icons[type] || icons.info}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${this.getTitle(type)}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" data-notification-id="${id}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                // Add click handler for close button
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    this.remove(id);
                });
                
                return notification;
            }
            
            getTitle(type) {
                const titles = {
                    success: 'Success',
                    error: 'Error',
                    warning: 'Warning',
                    info: 'Information'
                };
                return titles[type] || 'Notification';
            }
            
            remove(id) {
                const notification = document.getElementById(`notification-${id}`);
                if (notification) {
                    notification.classList.add('hiding');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                        this.notifications = this.notifications.filter(n => n.id !== id);
                    }, 300);
                }
            }
            
            clearAll() {
                this.notifications.forEach(notification => {
                    if (notification.element.parentNode) {
                        notification.element.parentNode.removeChild(notification.element);
                    }
                });
                this.notifications = [];
            }
            
            // New method for confirm dialogs
            confirm(message, confirmCallback, cancelCallback = null) {
                const id = this.nextId++;
                const notification = document.createElement('div');
                notification.className = 'notification warning';
                notification.id = `notification-${id}`;
                
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="notification-content action-notification">
                        <div class="notification-title">Confirm Action</div>
                        <div class="notification-message">${message}</div>
                        <div class="action-notification-buttons">
                            <button class="action-notification-btn cancel" data-action="cancel">
                                Cancel
                            </button>
                            <button class="action-notification-btn confirm" data-action="confirm">
                                Confirm
                            </button>
                        </div>
                    </div>
                    <button class="notification-close" data-notification-id="${id}" data-action="cancel">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                this.container.appendChild(notification);
                this.notifications.push({ id, element: notification });
                
                // Set up event listeners
                const confirmBtn = notification.querySelector('[data-action="confirm"]');
                const cancelBtn = notification.querySelector('[data-action="cancel"]');
                const closeBtn = notification.querySelector('.notification-close');
                
                const cleanup = () => {
                    this.remove(id);
                };
                
                confirmBtn.addEventListener('click', () => {
                    cleanup();
                    if (confirmCallback) confirmCallback();
                });
                
                cancelBtn.addEventListener('click', () => {
                    cleanup();
                    if (cancelCallback) cancelCallback();
                });
                
                closeBtn.addEventListener('click', () => {
                    cleanup();
                    if (cancelCallback) cancelCallback();
                });
                
                return id;
            }
        }        // Initialize notification system globally
        const notificationSystem = new NotificationSystem();
        
        // Helper function to show notifications (replaces alert())
        function showNotification(message, type = 'info', duration = 5000) {
            return notificationSystem.show(message, type, duration);
        }
        
        // Helper function to show confirm dialogs (replaces confirm())
        function showConfirm(message, confirmCallback, cancelCallback = null) {
            return notificationSystem.confirm(message, confirmCallback, cancelCallback);
        }        // =============================================
        // URL LINKIFY FUNCTION
        // =============================================
        function linkify(text) {
            if (!text) return text;
            
            // URL pattern
            const urlPattern = /(https?:\/\/[^\s]+)/g;
            
            // Email pattern (optional)
            const emailPattern = /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g;
            
            // Replace URLs with clickable links
            let linkedText = text.replace(urlPattern, function(url) {
                // Clean URL for display (remove http:// or https://)
                let displayUrl = url;
                if (url.startsWith('http://')) {
                    displayUrl = url.substring(7);
                } else if (url.startsWith('https://')) {
                    displayUrl = url.substring(8);
                }
                
                // Truncate long URLs for display
                if (displayUrl.length > 50) {
                    displayUrl = displayUrl.substring(0, 47) + '...';
                }
                
                // Make sure URL has proper protocol
                let href = url;
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    href = 'https://' + url;
                }
                
                return `<a href="${href}" target="_blank" rel="noopener noreferrer">${displayUrl}</a>`;
            });
            
            // Replace emails with mailto links
            linkedText = linkedText.replace(emailPattern, function(email) {
                return `<a href="mailto:${email}">${email}</a>`;
            });
            
            return linkedText;
        }        // =============================================
        // SMART FEED MANAGEMENT SYSTEM
        // =============================================        // ImgBB API Key
        const IMGBB_API_KEY = 'aa5691861a89b4a0aa5ab95300bf86a1';
        const IMGBB_API_URL = 'https://api.imgbb.com/1/upload';        // Social Media URLs for Silranus
        const SOCIAL_MEDIA_URLS = {
            youtube: 'https://youtube.com/@silrancoin?si=nHmESw5wF6nVFVbL',
            instagram: '#',
            facebook: '#',
            twitter: 'https://x.com/silrancoin?s=20',
            telegram: 'https://t.me/+kSsiiv5ZFkMxODFk',
            discord: '#'
        };        // Available avatars
        const availableAvatars = [
            "https://iili.io/fky6q9s.jpg",
            "https://iili.io/fky6FcX.jpg",
            "https://iili.io/fky63Ft.jpg",
            "https://iili.io/fky6JMN.jpg",
            "https://iili.io/fky4KTx.jpg",
            "https://iili.io/fky43pj.jpg",
            "https://iili.io/fky42kb.jpg",
            "https://iili.io/fky4fhQ.jpg"
        ];        // Current User Data
        let currentUser = null;
        let selectedAvatar = null;
        let userNotifications = [];
        let currentPostType = 'text';        // YouTube URL to Embed Converter
        function convertToEmbedUrl(url) {
            try {
                // Remove any query parameters and fragments
                let cleanUrl = url.split('?')[0].split('#')[0];
                
                // Handle youtu.be short URLs
                if (cleanUrl.includes('youtu.be/')) {
                    const videoId = cleanUrl.split('youtu.be/')[1];
                    return `https://www.youtube.com/embed/${videoId}`;
                }
                
                // Handle youtube.com URLs
                if (cleanUrl.includes('youtube.com/')) {
                    // Handle shorts
                    if (cleanUrl.includes('/shorts/')) {
                        const videoId = cleanUrl.split('/shorts/')[1];
                        return `https://www.youtube.com/embed/${videoId}`;
                    }
                    
                    // Handle live videos
                    if (cleanUrl.includes('/live/')) {
                        const videoId = cleanUrl.split('/live/')[1];
                        return `https://www.youtube.com/embed/${videoId}`;
                    }
                    
                    // Handle watch?v= format
                    if (cleanUrl.includes('watch?v=')) {
                        const videoId = cleanUrl.split('watch?v=')[1];
                        return `https://www.youtube.com/embed/${videoId}`;
                    }
                    
                    // Handle embed URLs (already correct)
                    if (cleanUrl.includes('embed/')) {
                        return cleanUrl;
                    }
                }
                
                return null;
            } catch (error) {
                console.error('Error converting YouTube URL:', error);
                return null;
            }
        }        // Validate YouTube URL
        function isValidYouTubeUrl(url) {
            const patterns = [
                /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.?be)\/.+$/,
                /^(https?:\/\/)?(www\.)?youtube\.com\/shorts\/[a-zA-Z0-9_-]+$/,
                /^(https?:\/\/)?(www\.)?youtube\.com\/live\/[a-zA-Z0-9_-]+$/,
                /^(https?:\/\/)?(www\.)?youtu\.be\/[a-zA-Z0-9_-]+$/
            ];
            
            return patterns.some(pattern => pattern.test(url));
        }        // Smart Feed Manager
        class SmartFeedManager {
            constructor() {
                this.cachedPosts = [];
                this.lastFetchedAt = null;
                this.isMediaPlaying = false;
                this.newPostsCount = 0;
                this.mediaElements = new Set();
                this.backgroundCheckInterval = null;
                this.initialized = false;
            }
            
            async init() {
                if (this.initialized) return;
                
                console.log('Initializing Smart Feed Manager...');
                this.setupMediaListeners();
                await this.loadInitialPosts();
                this.startBackgroundCheck();
                this.initialized = true;
            }
            
            setupMediaListeners() {
                // Detect video/audio elements
                document.addEventListener('play', (e) => {
                    if (e.target.tagName === 'VIDEO' || e.target.tagName === 'AUDIO' || e.target.tagName === 'IFRAME') {
                        this.isMediaPlaying = true;
                        this.mediaElements.add(e.target);
                        console.log('Media started playing, feed updates paused');
                    }
                }, true);
                
                document.addEventListener('pause', (e) => {
                    if (e.target.tagName === 'VIDEO' || e.target.tagName === 'AUDIO') {
                        this.mediaElements.delete(e.target);
                        if (this.mediaElements.size === 0) {
                            this.isMediaPlaying = false;
                            console.log('All media paused, feed updates resumed');
                        }
                    }
                }, true);
                
                // Also listen for ended events
                document.addEventListener('ended', (e) => {
                    if (e.target.tagName === 'VIDEO' || e.target.tagName === 'AUDIO') {
                        this.mediaElements.delete(e.target);
                        if (this.mediaElements.size === 0) {
                            this.isMediaPlaying = false;
                        }
                    }
                }, true);
            }
            
            async loadInitialPosts() {
                console.log('Loading initial posts...');
                const posts = await loadPosts();
                this.cachedPosts = posts;
                this.lastFetchedAt = new Date().toISOString();
                return posts;
            }
            
            async loadFreshPosts() {
                console.log('Loading fresh posts...');
                
                // Check if media is playing
                if (this.isMediaPlaying) {
                    showConfirm("Media is currently playing. Refreshing the feed will interrupt playback. Refresh anyway?", 
                        async () => {
                            console.log('User confirmed refresh despite media playback');
                            await this.performRefresh();
                        },
                        () => {
                            console.log('User cancelled refresh due to media playback');
                        }
                    );
                    return this.cachedPosts;
                }
                
                await this.performRefresh();
                return this.cachedPosts;
            }
            
            async performRefresh() {
                // Show loading indicator
                const postsContainer = document.getElementById('postsContainer');
                const originalContent = postsContainer.innerHTML;
                postsContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-dim);"><div class="loading"></div><p style="margin-top: 10px;">Refreshing feed...</p></div>';
                
                try {
                    const posts = await loadFreshPosts();
                    this.cachedPosts = posts;
                    this.lastFetchedAt = new Date().toISOString();
                    this.newPostsCount = 0;
                    this.hideRefreshBanner();
                    
                    console.log('Feed refreshed successfully');
                    return posts;
                } catch (error) {
                    console.error('Error refreshing feed:', error);
                    postsContainer.innerHTML = originalContent;
                    showNotification('Failed to refresh feed. Please try again.', 'error');
                    return this.cachedPosts;
                }
            }
            
            startBackgroundCheck() {
                // Clear existing interval if any
                if (this.backgroundCheckInterval) {
                    clearInterval(this.backgroundCheckInterval);
                }
                
                // Check for new posts every 30 seconds
                this.backgroundCheckInterval = setInterval(async () => {
                    await this.checkForNewPosts();
                }, 30000);
                
                console.log('Background check started (30s interval)');
            }
            
            stopBackgroundCheck() {
                if (this.backgroundCheckInterval) {
                    clearInterval(this.backgroundCheckInterval);
                    this.backgroundCheckInterval = null;
                }
            }
            
            async checkForNewPosts() {
                if (!currentUser || !this.lastFetchedAt) {
                    return false;
                }
                
                try {
                    const { collection, getDocs, query, orderBy, where, limit } = window.getFirestoreFunctions;
                    const postsRef = collection(window.db, 'posts');
                    
                    // Get the latest post timestamp from Firebase
                    const latestPostQuery = query(postsRef, orderBy('timestamp', 'desc'), limit(1));
                    const latestSnapshot = await getDocs(latestPostQuery);
                    
                    if (latestSnapshot.empty) {
                        return false;
                    }
                    
                    const latestPost = latestSnapshot.docs[0].data();
                    const latestTimestamp = latestPost.timestamp;
                    
                    // Check if there are new posts
                    const newPostsQuery = query(
                        postsRef, 
                        orderBy('timestamp', 'desc'),
                        where('timestamp', '>', this.lastFetchedAt)
                    );
                    
                    const newPostsSnapshot = await getDocs(newPostsQuery);
                    const newCount = newPostsSnapshot.size;
                    
                    if (newCount > 0) {
                        this.newPostsCount = newCount;
                        
                        // Only show banner if no media is playing
                        if (!this.isMediaPlaying) {
                            this.showRefreshBanner(newCount);
                        }
                        
                        return true;
                    }
                    
                    return false;
                } catch (error) {
                    console.error('Error checking for new posts:', error);
                    return false;
                }
            }
            
            showRefreshBanner(count) {
                // Remove existing banner
                const existingBanner = document.querySelector('.refresh-banner');
                if (existingBanner) {
                    existingBanner.remove();
                }
                
                // Create new banner
                const banner = document.createElement('div');
                banner.className = 'refresh-banner';
                banner.innerHTML = `
                    <i class="fas fa-sync-alt"></i>
                    <span>${count} new post${count > 1 ? 's' : ''} available</span>
                    <div class="refresh-count">${count}</div>
                `;
                
                banner.addEventListener('click', async () => {
                    console.log('Refresh banner clicked, loading fresh posts...');
                    await this.loadFreshPosts();
                });
                
                document.body.appendChild(banner);
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    if (document.body.contains(banner)) {
                        banner.style.animation = 'slideUp 0.3s ease-out';
                        setTimeout(() => {
                            if (document.body.contains(banner)) {
                                banner.remove();
                            }
                        }, 300);
                    }
                }, 10000);
                
                console.log(`Refresh banner shown for ${count} new posts`);
            }
            
            hideRefreshBanner() {
                const banner = document.querySelector('.refresh-banner');
                if (banner) {
                    banner.style.animation = 'slideUp 0.3s ease-out';
                    setTimeout(() => {
                        if (document.body.contains(banner)) {
                            banner.remove();
                        }
                    }, 300);
                }
            }
            
            // Get current feed status
            getStatus() {
                return {
                    initialized: this.initialized,
                    postCount: this.cachedPosts.length,
                    lastFetched: this.lastFetchedAt,
                    mediaPlaying: this.isMediaPlaying,
                    newPostsAvailable: this.newPostsCount > 0,
                    newPostsCount: this.newPostsCount
                };
            }
        }        // =============================================
        // FIXED BOOKMARK SYSTEM
        // =============================================
        const BOOKMARKS_STORAGE_KEY = 'silranus_bookmarks_complete';
        const BOOKMARKS_BACKUP_KEY = 'silranus_bookmarks_backup';        function getBookmarks() {
            try {
                const bookmarksJSON = localStorage.getItem(BOOKMARKS_STORAGE_KEY);
                if (!bookmarksJSON) return [];
                
                const bookmarks = JSON.parse(bookmarksJSON);
                
                const validBookmarks = bookmarks.filter(bookmark => 
                    bookmark && 
                    bookmark.id && 
                    bookmark.text !== undefined
                );
                
                if (validBookmarks.length !== bookmarks.length) {
                    saveBookmarks(validBookmarks);
                }
                
                return validBookmarks;
            } catch (error) {
                console.error('Error getting bookmarks:', error);
                return [];
            }
        }        function saveBookmarks(bookmarks) {
            try {
                localStorage.setItem(BOOKMARKS_STORAGE_KEY, JSON.stringify(bookmarks));
                localStorage.setItem(BOOKMARKS_BACKUP_KEY, JSON.stringify(bookmarks));
                
                updateBookmarkButton();
                return true;
            } catch (error) {
                console.error('Error saving bookmarks:', error);
                return false;
            }
        }        async function addBookmark(postId) {
            try {
                let completePost = await getPostFromFirebase(postId);
                
                if (!completePost) {
                    completePost = await getPostFromCacheOrDOM(postId);
                }
                
                if (!completePost) {
                    throw new Error('Could not find post data');
                }
                
                const bookmarks = getBookmarks();
                
                const exists = bookmarks.some(bookmark => bookmark.id === postId);
                if (exists) {
                    return { success: false, message: 'Already bookmarked' };
                }
                
                const bookmarkWithTimestamp = {
                    id: completePost.id,
                    uid: completePost.uid || '',
                    username: completePost.username || 'Silranus Digital',
                    avatar: completePost.avatar || 'https://iili.io/fky6q9s.jpg',
                    text: completePost.text || '',
                    title: completePost.title || '',
                    youtubeUrl: completePost.youtubeUrl || '',
                    embedUrl: completePost.embedUrl || '',
                    imageUrl: completePost.imageUrl || '',
                    timestamp: completePost.timestamp || new Date().toISOString(),
                    likes: completePost.likes || 0,
                    likedBy: completePost.likedBy || [],
                    comments: completePost.comments || [],
                    savedAt: new Date().toISOString(),
                    source: completePost.source || 'firebase',
                    isLocalCopy: true
                };
                
                bookmarks.unshift(bookmarkWithTimestamp);
                
                const saved = saveBookmarks(bookmarks);
                
                if (saved) {
                    return { 
                        success: true, 
                        message: 'Post saved to bookmarks',
                        bookmark: bookmarkWithTimestamp
                    };
                } else {
                    throw new Error('Failed to save bookmark');
                }
            } catch (error) {
                console.error('Error adding bookmark:', error);
                return { 
                    success: false, 
                    message: 'Failed to save bookmark: ' + error.message 
                };
            }
        }        async function getPostFromFirebase(postId) {
            try {
                const { doc, getDoc } = window.getFirestoreFunctions;
                if (!doc || !getDoc) throw new Error('Firebase not initialized');
                
                const postRef = doc(window.db, 'posts', postId);
                const postSnap = await getDoc(postRef);
                
                if (postSnap.exists()) {
                    const postData = postSnap.data();
                    return {
                        id: postSnap.id,
                        ...postData,
                        source: 'firebase'
                    };
                }
                return null;
            } catch (error) {
                console.error('Error fetching post from Firebase:', error);
                return null;
            }
        }        async function getPostFromCacheOrDOM(postId) {
            try {
                const cachedPosts = cache.get(CACHE_KEYS.POSTS) || [];
                const cachedPost = cachedPosts.find(p => p.id === postId);
                
                if (cachedPost) {
                    return {
                        ...cachedPost,
                        source: 'cache'
                    };
                }
                
                const postElement = document.getElementById(`post-${postId}`);
                if (postElement) {
                    return extractPostFromDOM(postElement, postId);
                }
                
                return null;
            } catch (error) {
                console.error('Error getting post from cache/DOM:', error);
                return null;
            }
        }        function extractPostFromDOM(postElement, postId) {
            try {
                const username = postElement.querySelector('.user-info h3')?.textContent || 'Silranus Digital';
                const avatar = postElement.querySelector('.user-avatar')?.src || 'https://iili.io/fky6q9s.jpg';
                const text = postElement.querySelector('.post-text')?.textContent || '';
                const imageUrl = postElement.querySelector('.post-image')?.src || '';
                const timeText = postElement.querySelector('.user-info p')?.textContent || '';
                const title = postElement.querySelector('.post-title')?.textContent || '';
                
                const likeCountElement = postElement.querySelector('.like-count');
                let likes = 0;
                if (likeCountElement) {
                    const likeText = likeCountElement.textContent;
                    const match = likeText.match(/(\d+)/);
                    likes = match ? parseInt(match[1]) : 0;
                }
                
                return {
                    id: postId,
                    username: username,
                    avatar: avatar,
                    text: text,
                    title: title,
                    imageUrl: imageUrl,
                    timestamp: estimateTimestampFromTimeText(timeText),
                    likes: likes,
                    likedBy: [],
                    comments: [],
                    source: 'dom',
                    isLocalCopy: true
                };
            } catch (error) {
                console.error('Error extracting post from DOM:', error);
                return null;
            }
        }        function estimateTimestampFromTimeText(timeText) {
            try {
                const now = new Date();
                
                if (timeText.includes('Just now')) {
                    return now.toISOString();
                }
                
                if (timeText.includes('min ago')) {
                    const mins = parseInt(timeText);
                    if (!isNaN(mins)) {
                        now.setMinutes(now.getMinutes() - mins);
                        return now.toISOString();
                    }
                }
                
                if (timeText.includes('hour')) {
                    const hours = parseInt(timeText);
                    if (!isNaN(hours)) {
                        now.setHours(now.getHours() - hours);
                        return now.toISOString();
                    }
                }
                
                if (timeText.includes('day')) {
                    const days = parseInt(timeText);
                    if (!isNaN(days)) {
                        now.setDate(now.getDate() - days);
                        return now.toISOString();
                    }
                }
                
                return new Date().toISOString();
            } catch (error) {
                console.error('Error estimating timestamp:', error);
                return new Date().toISOString();
            }
        }        function removeBookmark(postId) {
            try {
                const bookmarks = getBookmarks();
                const newBookmarks = bookmarks.filter(bookmark => bookmark.id !== postId);
                
                const saved = saveBookmarks(newBookmarks);
                
                if (saved) {
                    return { success: true, message: 'Bookmark removed' };
                } else {
                    throw new Error('Failed to remove bookmark');
                }
            } catch (error) {
                console.error('Error removing bookmark:', error);
                return { success: false, message: 'Failed to remove bookmark' };
            }
        }        function isPostBookmarked(postId) {
            const bookmarks = getBookmarks();
            return bookmarks.some(bookmark => bookmark.id === postId);
        }        function updateBookmarkButton() {
            const bookmarkBtn = document.getElementById('bookmarkFloatingBtn');
            const bookmarks = getBookmarks();
            
            if (bookmarkBtn) {
                if (bookmarks.length > 0) {
                    bookmarkBtn.classList.add('has-bookmarks');
                } else {
                    bookmarkBtn.classList.remove('has-bookmarks');
                }
            }
        }        // =============================================
        // CACHING SYSTEM
        // =============================================
        const CACHE_KEYS = {
            POSTS: 'silranus_posts_cache',
            USER_PROFILE: 'silranus_user_cache',
            NOTIFICATIONS: 'silranus_notifications_cache'
        };        const CACHE_TTL = {
            POSTS: 5 * 60 * 1000,
            USER_PROFILE: 30 * 60 * 1000,
            NOTIFICATIONS: 2 * 60 * 1000,
            TRENDING: 60 * 60 * 1000
        };        const cache = {
            get(key, type = 'localStorage') {
                try {
                    if (type === 'localStorage') {
                        const cached = localStorage.getItem(key);
                        if (!cached) return null;
                        
                        const parsed = JSON.parse(cached);
                        if (parsed.expiry && Date.now() > parsed.expiry) {
                            localStorage.removeItem(key);
                            return null;
                        }
                        return parsed.data;
                    }
                    return null;
                } catch (error) {
                    console.error('Cache get error:', error);
                    return null;
                }
            },            set(key, data, ttl = null, type = 'localStorage') {
                try {
                    const cacheItem = {
                        data: data,
                        timestamp: Date.now(),
                        expiry: ttl ? Date.now() + ttl : null
                    };                    if (type === 'localStorage') {
                        localStorage.setItem(key, JSON.stringify(cacheItem));
                    }
                } catch (error) {
                    console.error('Cache set error:', error);
                }
            },            remove(key, type = 'localStorage') {
                if (type === 'localStorage') {
                    localStorage.removeItem(key);
                }
            },            clear() {
                Object.values(CACHE_KEYS).forEach(key => {
                    localStorage.removeItem(key);
                });
            }
        };        // =============================================
        // UPDATED COMMENT SYSTEM
        // =============================================
        async function addComment(postId, commentData) {
            try {
                const { doc, updateDoc, arrayUnion } = window.getFirestoreFunctions;
                const postRef = doc(window.db, 'posts', postId);
                
                const comment = {
                    id: 'comment_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    uid: commentData.uid,
                    username: commentData.username,
                    avatar: commentData.avatar,
                    text: commentData.text,
                    timestamp: new Date().toISOString(),
                    likes: 0,
                    likedBy: []
                };
                
                await updateDoc(postRef, {
                    comments: arrayUnion(comment)
                });
                
                return comment;
            } catch (error) {
                console.error('Error adding comment:', error);
                return null;
            }
        }        async function toggleCommentLike(postId, commentId, userId) {
            try {
                const { doc, getDoc, updateDoc } = window.getFirestoreFunctions;
                const postRef = doc(window.db, 'posts', postId);
                const postSnap = await getDoc(postRef);
                
                if (!postSnap.exists()) return false;
                
                const post = postSnap.data();
                const comments = post.comments || [];
                
                // Find the comment
                const commentIndex = comments.findIndex(comment => comment.id === commentId);
                if (commentIndex === -1) return false;
                
                const comment = comments[commentIndex];
                const likedBy = comment.likedBy || [];
                
                if (likedBy.includes(userId)) {
                    // Unlike
                    comment.likedBy = likedBy.filter(id => id !== userId);
                    comment.likes = Math.max(0, (comment.likes || 1) - 1);
                } else {
                    // Like
                    comment.likedBy = [...likedBy, userId];
                    comment.likes = (comment.likes || 0) + 1;
                }
                
                comments[commentIndex] = comment;
                
                await updateDoc(postRef, { comments: comments });
                
                return !likedBy.includes(userId);
            } catch (error) {
                console.error('Error toggling comment like:', error);
                return null;
            }
        }        async function deleteComment(postId, commentId) {
            try {
                const { doc, getDoc, updateDoc } = window.getFirestoreFunctions;
                const postRef = doc(window.db, 'posts', postId);
                const postSnap = await getDoc(postRef);
                
                if (!postSnap.exists()) return false;
                
                const post = postSnap.data();
                const comments = post.comments || [];
                
                // Find the comment index
                const commentIndex = comments.findIndex(comment => comment.id === commentId);
                if (commentIndex === -1) return false;
                
                // Remove the comment
                comments.splice(commentIndex, 1);
                
                // Update the post
                await updateDoc(postRef, { comments: comments });
                
                return true;
            } catch (error) {
                console.error('Error deleting comment:', error);
                return false;
            }
        }        // =============================================
        // FIREBASE FUNCTIONS
        // =============================================
        async function checkUsernameExists(username) {
            try {
                const { collection, getDocs, query, where } = window.getFirestoreFunctions;
                const usersRef = collection(window.db, 'users');
                const q = query(usersRef, where('username', '==', username.toLowerCase()));
                const querySnapshot = await getDocs(q);
                return !querySnapshot.empty;
            } catch (error) {
                console.error('Error checking username:', error);
                return false;
            }
        }        async function createUserProfile(userId, userData) {
            try {
                const { doc, setDoc } = window.getFirestoreFunctions;
                const userDoc = doc(window.db, 'users', userId);
                
                const userProfile = {
                    uid: userId,
                    username: userData.username.toLowerCase(),
                    email: userData.email,
                    avatar: userData.avatar,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    notifications: []
                };
                
                await setDoc(userDoc, userProfile);
                
                cache.set(`${CACHE_KEYS.USER_PROFILE}_${userId}`, userProfile, CACHE_TTL.USER_PROFILE);
                
                return userProfile;
            } catch (error) {
                console.error('Error creating user profile:', error);
                return null;
            }
        }        async function getUserProfile(userId) {
            const cacheKey = `${CACHE_KEYS.USER_PROFILE}_${userId}`;
            
            const cachedProfile = cache.get(cacheKey);
            if (cachedProfile) {
                return cachedProfile;
            }            try {
                const { doc, getDoc } = window.getFirestoreFunctions;
                const userDoc = doc(window.db, 'users', userId);
                const docSnap = await getDoc(userDoc);
                
                if (docSnap.exists()) {
                    const userProfile = docSnap.data();
                    cache.set(cacheKey, userProfile, CACHE_TTL.USER_PROFILE);
                    return userProfile;
                }
                return null;
            } catch (error) {
                console.error('Error getting user profile:', error);
                return null;
            }
        }        async function updateLastLogin(userId) {
            try {
                const { doc, setDoc } = window.getFirestoreFunctions;
                const userDoc = doc(window.db, 'users', userId);
                await setDoc(userDoc, { lastLogin: new Date().toISOString() }, { merge: true });
            } catch (error) {
                console.error('Error updating last login:', error);
            }
        }        async function loadPosts() {
            const cacheKey = CACHE_KEYS.POSTS;
            
            const cachedPosts = cache.get(cacheKey);
            if (cachedPosts && cachedPosts.length > 0) {
                displayPosts(cachedPosts);
                setTimeout(loadFreshPosts, 100);
                return cachedPosts;
            }
            
            return await loadFreshPosts();
        }        async function loadFreshPosts() {
            try {
                const { collection, getDocs, query, orderBy } = window.getFirestoreFunctions;
                const postsRef = collection(window.db, 'posts');
                const q = query(postsRef, orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                const posts = [];
                querySnapshot.forEach((doc) => {
                    posts.push({ id: doc.id, ...doc.data() });
                });
                
                cache.set(CACHE_KEYS.POSTS, posts, CACHE_TTL.POSTS);
                displayPosts(posts);
                
                return posts;
            } catch (error) {
                console.error('Error loading posts:', error);
                const cachedPosts = cache.get(CACHE_KEYS.POSTS);
                if (cachedPosts && cachedPosts.length > 0) {
                    displayPosts(cachedPosts);
                    return cachedPosts;
                }
                return [];
            }
        }        function displayPosts(posts) {
            const postsContainer = document.getElementById('postsContainer');
            if (!postsContainer) return;
            
            const scrollTop = postsContainer.scrollTop;
            
            if (posts.length === 0) {
                postsContainer.innerHTML = '<p style="text-align: center; color: var(--text-dim);">No posts yet. Be the first to share!</p>';
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            posts.forEach(post => {
                const postElement = createPostElement(post);
                fragment.appendChild(postElement);
            });
            
            postsContainer.innerHTML = '';
            postsContainer.appendChild(fragment);
            
            if (scrollTop > 0 && postsContainer.scrollHeight > postsContainer.clientHeight) {
                postsContainer.scrollTop = scrollTop;
            }
            
            // Initialize lazy loading for all images
            setTimeout(lazyLoadImages, 100);
        }        function createPostElement(post) {
            const postDiv = document.createElement('div');
            postDiv.className = 'post';
            postDiv.id = `post-${post.id}`;
            postDiv.setAttribute('data-post-id', post.id);
            
            const timeAgo = getTimeAgo(post.timestamp);
            const isLiked = post.likedBy && currentUser && post.likedBy.includes(currentUser.uid);
            const isBookmarked = isPostBookmarked(post.id);
            const comments = post.comments || [];
            const commentsCount = comments.length;
            const isPostOwner = currentUser && post.uid === currentUser.uid;
            
            const avatarSrc = post.avatar || 'https://iili.io/fky6q9s.jpg';
            
            // Determine content type and create appropriate HTML
            let contentHtml = '';
            
            if (post.youtubeUrl || post.embedUrl) {
                // YouTube video post
                const embedUrl = post.embedUrl || convertToEmbedUrl(post.youtubeUrl) || post.youtubeUrl;
                contentHtml = `
                    ${post.title ? `<div class="post-title">${post.title}</div>` : ''}
                    <div class="youtube-video-container">
                        <iframe src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    ${post.text ? `<p class="post-text">${linkify(post.text)}</p>` : ''}
                `;
            } else if (post.imageUrl) {
                // Image post
                contentHtml = `
                    ${post.text ? `<p class="post-text">${linkify(post.text)}</p>` : ''}
                    <img src="${post.imageUrl}" class="post-image" alt="Post image" loading="lazy" onload="this.classList.add('loaded')">
                `;
            } else {
                // Text post
                contentHtml = post.text ? `<p class="post-text">${linkify(post.text)}</p>` : '';
            }
            
            postDiv.innerHTML = `
                <div class="post-header">
                    <div class="post-user">
                        <img src="${avatarSrc}" class="user-avatar" alt="${post.username}" loading="lazy" style="width: 48px; height: 48px;" onload="this.classList.add('loaded')">
                        <div class="user-info">
                            <h3>${post.username}</h3>
                            <p>${timeAgo}</p>
                        </div>
                    </div>
                </div>
                
                <div class="post-content">
                    ${contentHtml}
                </div>
                
                <div class="post-actions">
                    <button class="post-action like-btn ${isLiked ? 'liked' : ''}" data-post-id="${post.id}" data-liked="${isLiked}">
                        <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
                        <span class="like-count">${post.likes || 0} ${post.likes === 1 ? 'Like' : 'Likes'}</span>
                    </button>
                    <button class="post-action bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" data-post-id="${post.id}">
                        <i class="${isBookmarked ? 'fas' : 'far'} fa-bookmark"></i>
                        <span>${isBookmarked ? 'Saved' : 'Save'}</span>
                    </button>
                </div>
                
                <div class="comments-section">
                    <div class="comments-header" id="commentsToggle-${post.id}">
                        <span>${commentsCount} ${commentsCount === 1 ? 'comment' : 'comments'}</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    
                    <div class="comments-list" id="commentsList-${post.id}" style="display: none;">
                        ${comments.length > 0 ? 
                            comments.map(comment => {
                                const isCommentOwner = currentUser && comment.uid === currentUser.uid;
                                const isCommentLiked = comment.likedBy && currentUser && comment.likedBy.includes(currentUser.uid);
                                const commentTimeAgo = getTimeAgo(comment.timestamp);
                                const commentLikes = comment.likes || 0;
                                
                                return `
                                    <div class="comment" data-comment-id="${comment.id}">
                                        <img src="${comment.avatar || 'https://iili.io/fky6q9s.jpg'}" class="comment-avatar" alt="${comment.username}" loading="lazy" onload="this.classList.add('loaded')">
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-username">
                                                    ${comment.username}
                                                    ${isCommentOwner ? '<i class="fas fa-check-circle comment-verified"></i>' : ''}
                                                </span>
                                                <span class="comment-time">${commentTimeAgo}</span>
                                            </div>
                                            <p class="comment-text">${linkify(comment.text)}</p>
                                            <div class="comment-actions">
                                                <button class="comment-like-btn ${isCommentLiked ? 'liked' : ''}" data-post-id="${post.id}" data-comment-id="${comment.id}">
                                                    <i class="${isCommentLiked ? 'fas' : 'far'} fa-heart"></i>
                                                    <span class="comment-like-count">${commentLikes}</span>
                                                </button>
                                                <button class="comment-reply-btn" data-post-id="${post.id}" data-comment-id="${comment.id}">
                                                    <i class="far fa-comment"></i>
                                                    <span>Reply</span>
                                                </button>
                                            </div>
                                        </div>
                                        ${isCommentOwner ? `
                                            <button class="comment-delete-btn" data-post-id="${post.id}" data-comment-id="${comment.id}" title="Delete Comment">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('') : 
                            '<div class="no-comments"><i class="far fa-comments"></i><p>No comments yet</p><p style="font-size: 13px; margin-top: 5px;">Be the first to comment!</p></div>'
                        }
                    </div>
                    
                    ${currentUser ? `
                        <div class="add-comment" id="addComment-${post.id}">
                            <div class="comment-input-container">
                                <input type="text" class="comment-input" placeholder="Add a comment..." id="commentInput-${post.id}" maxlength="150">
                                <div class="comment-char-counter" id="commentCharCounter-${post.id}">0/150</div>
                            </div>
                            <button class="comment-submit" data-post-id="${post.id}" id="commentSubmit-${post.id}">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
            
            return postDiv;
        }        async function toggleLike(postId, userId) {
            try {
                const { doc, getDoc, updateDoc, arrayUnion, arrayRemove, increment } = window.getFirestoreFunctions;
                const postRef = doc(window.db, 'posts', postId);
                const postSnap = await getDoc(postRef);
                
                if (!postSnap.exists()) return false;
                
                const post = postSnap.data();
                const likedBy = post.likedBy || [];
                
                const cachedPosts = cache.get(CACHE_KEYS.POSTS) || [];
                const postIndex = cachedPosts.findIndex(p => p.id === postId);
                
                if (likedBy.includes(userId)) {
                    await updateDoc(postRef, {
                        likedBy: arrayRemove(userId),
                        likes: increment(-1)
                    });
                    
                    if (postIndex !== -1) {
                        cachedPosts[postIndex].likedBy = likedBy.filter(id => id !== userId);
                        cachedPosts[postIndex].likes = (cachedPosts[postIndex].likes || 1) - 1;
                        cache.set(CACHE_KEYS.POSTS, cachedPosts, CACHE_TTL.POSTS);
                    }
                    
                    return false;
                } else {
                    await updateDoc(postRef, {
                        likedBy: arrayUnion(userId),
                        likes: increment(1)
                    });
                    
                    if (postIndex !== -1) {
                        cachedPosts[postIndex].likedBy = [...likedBy, userId];
                        cachedPosts[postIndex].likes = (cachedPosts[postIndex].likes || 0) + 1;
                        cache.set(CACHE_KEYS.POSTS, cachedPosts, CACHE_TTL.POSTS);
                    }
                    
                    return true;
                }
            } catch (error) {
                console.error('Error toggling like:', error);
                return null;
            }
        }        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            
            if (diffMs < 60000) return 'Just now';
            if (diffMs < 3600000) return `${Math.floor(diffMs / 60000)} min ago`;
            if (diffMs < 86400000) return `${Math.floor(diffMs / 3600000)} hour${Math.floor(diffMs / 3600000) > 1 ? 's' : ''} ago`;
            if (diffMs < 604800000) return `${Math.floor(diffMs / 86400000)} day${Math.floor(diffMs / 86400000) > 1 ? 's' : ''} ago`;
            
            return time.toLocaleDateString();
        }        // =============================================
        // LOAD AND DISPLAY BOOKMARKS
        // =============================================
        function loadAndDisplayBookmarks() {
            const bookmarks = getBookmarks();
            const container = document.getElementById('bookmarksContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (bookmarks.length === 0) {
                container.innerHTML = `
                    <div class="no-bookmarks">
                        <i class="fas fa-bookmark"></i>
                        <p>No saved posts yet</p>
                        <p style="font-size: 14px; margin-top: 10px;">Bookmark posts to see them here</p>
                    </div>
                `;
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            bookmarks.forEach(bookmark => {
                const bookmarkElement = createBookmarkedPostElement(bookmark);
                fragment.appendChild(bookmarkElement);
            });
            
            container.appendChild(fragment);
            
            // Add only clear button
            const clearBtn = document.createElement('button');
            clearBtn.innerHTML = '<i class="fas fa-trash"></i> Clear All Bookmarks';
            clearBtn.style.cssText = 'margin: 20px auto; padding: 10px 20px; background: var(--error-red); color: white; border: none; border-radius: 20px; cursor: pointer; display: block;';
            clearBtn.addEventListener('click', () => {
                showConfirm('Are you sure you want to clear ALL bookmarks? This cannot be undone!', 
                    () => {
                        localStorage.removeItem(BOOKMARKS_STORAGE_KEY);
                        updateBookmarkButton();
                        loadAndDisplayBookmarks();
                        showNotification('All bookmarks cleared', 'success');
                    }
                );
            });
            
            container.appendChild(clearBtn);
        }        function createBookmarkedPostElement(bookmark) {
            const bookmarkDiv = document.createElement('div');
            bookmarkDiv.className = 'bookmarked-post';
            bookmarkDiv.id = `bookmark-${bookmark.id}`;
            
            const savedTimeAgo = getTimeAgo(bookmark.savedAt);
            const postTimeAgo = getTimeAgo(bookmark.timestamp);
            const commentsCount = bookmark.comments ? bookmark.comments.length : 0;
            
            const avatarSrc = bookmark.avatar || 'https://iili.io/fky6q9s.jpg';
            
            // Determine content type
            let contentHtml = '';
            if (bookmark.youtubeUrl || bookmark.embedUrl) {
                const embedUrl = bookmark.embedUrl || convertToEmbedUrl(bookmark.youtubeUrl) || bookmark.youtubeUrl;
                contentHtml = `
                    ${bookmark.title ? `<div class="post-title">${bookmark.title}</div>` : ''}
                    <div class="youtube-video-container">
                        <iframe src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    ${bookmark.text ? `<p class="bookmarked-post-text">${linkify(bookmark.text)}</p>` : ''}
                `;
            } else if (bookmark.imageUrl) {
                contentHtml = `
                    <p class="bookmarked-post-text">${linkify(bookmark.text)}</p>
                    <img src="${bookmark.imageUrl}" class="bookmarked-post-image" alt="Post image" loading="lazy" onload="this.classList.add('loaded')">
                `;
            } else {
                contentHtml = bookmark.text ? `<p class="bookmarked-post-text">${linkify(bookmark.text)}</p>` : '';
            }
            
            const sourceInfo = bookmark.source ? 
                `<div style="font-size: 10px; color: var(--text-dim); margin-top: 5px;">
                    Source: ${bookmark.source === 'firebase' ? 'Original Post' : 'Local Copy'}
                </div>` : '';
            
            bookmarkDiv.innerHTML = `
                <div class="bookmarked-post-header">
                    <div class="bookmarked-post-user">
                        <img src="${avatarSrc}" class="bookmarked-post-avatar" alt="${bookmark.username}" loading="lazy" onload="this.classList.add('loaded')">
                        <div class="bookmarked-post-info">
                            <h4>${bookmark.username}</h4>
                            <p>Posted ${postTimeAgo}</p>
                            ${sourceInfo}
                        </div>
                    </div>
                    <button class="remove-bookmark-btn" data-post-id="${bookmark.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                
                <div class="bookmarked-post-content">
                    ${contentHtml}
                    
                    ${commentsCount > 0 ? `
                        <div style="margin-top: 10px; padding: 10px; background: rgba(243, 146, 0, 0.1); border-radius: 8px;">
                            <div style="font-size: 12px; color: var(--accent-orange); margin-bottom: 5px;">
                                <i class="fas fa-comments"></i> ${commentsCount} ${commentsCount === 1 ? 'comment' : 'comments'} saved
                            </div>
                            ${bookmark.comments.slice(0, 2).map(comment => `
                                <div style="font-size: 11px; color: var(--text-main); margin-bottom: 3px;">
                                    <strong>${comment.username}:</strong> ${linkify(comment.text)}
                                </div>
                            `).join('')}
                            ${commentsCount > 2 ? `<div style="font-size: 10px; color: var(--text-dim);">+ ${commentsCount - 2} more comments</div>` : ''}
                        </div>
                    ` : ''}
                </div>
                
                <div class="bookmarked-post-footer">
                    <span>Saved ${savedTimeAgo}</span>
                    <span>${bookmark.likes || 0} likes</span>
                </div>
            `;
            
            return bookmarkDiv;
        }        // =============================================
        // LAZY LOADING IMAGES
        // =============================================
        function lazyLoadImages() {
            const images = document.querySelectorAll('img[loading="lazy"]');
            
            images.forEach(img => {
                if (img.complete) {
                    img.classList.add('loaded');
                } else {
                    img.addEventListener('load', () => {
                        img.classList.add('loaded');
                    });
                    
                    img.addEventListener('error', () => {
                        console.error('Failed to load image:', img.src);
                    });
                }
            });
        }        // =============================================
        // APP INITIALIZATION
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Smart Feed Manager
            const feedManager = new SmartFeedManager();
            
            // Get references to all screens
            const authScreen = document.getElementById('authScreen');
            const profileSetupScreen = document.getElementById('profileSetupScreen');
            const appInterface = document.getElementById('appInterface');
            
            // News Modal (Replaces Bot Modal)
            const newsModal = document.getElementById('newsModal');
            const closeNewsModal = document.getElementById('closeNewsModal');
            
            // Auth Elements
            const authTabs = document.querySelectorAll('.auth-tab');
            const authForms = document.querySelectorAll('.auth-form');
            const authLinks = document.querySelectorAll('.auth-link');
            
            // Login Form
            const loginForm = document.getElementById('loginForm');
            const loginEmail = document.getElementById('loginEmail');
            const loginPassword = document.getElementById('loginPassword');
            const loginBtn = document.getElementById('loginBtn');
            
            // Signup Form
            const signupForm = document.getElementById('signupForm');
            const signupEmail = document.getElementById('signupEmail');
            const signupPassword = document.getElementById('signupPassword');
            const signupConfirmPassword = document.getElementById('signupConfirmPassword');
            const signupBtn = document.getElementById('signupBtn');
            
            // Profile Setup Form
            const profileSetupForm = document.getElementById('profileSetupForm');
            const profileUsername = document.getElementById('profileUsername');
            const completeProfileBtn = document.getElementById('completeProfileBtn');
            const avatarGrid = document.getElementById('avatarGrid');
            const avatarError = document.getElementById('avatarError');
            
            // Error Messages
            const errorMessages = document.querySelectorAll('.error-message');            // App Elements
            const desktopNewsBtn = document.querySelector('.news-btn');
            const mobileNewsBtn = document.querySelector('.news-icon-mobile');
            const currentUsernameDisplay = document.getElementById('currentUsername');
            const categoryBtns = document.querySelectorAll('.category-btn');
            const postsContainer = document.getElementById('postsContainer');
            
            // Profile Elements
            const myProfileStory = document.getElementById('myProfileStory');
            const profileStoryAvatar = document.getElementById('profileStoryAvatar');
            const profileModal = document.getElementById('profileModal');
            const closeProfileModal = document.getElementById('closeProfileModal');
            const profileUsernameDisplay = document.getElementById('profileUsernameDisplay');
            const profileEmailDisplay = document.getElementById('profileEmailDisplay');
            const logoutBtn = document.getElementById('logoutBtn');
            const profileAvatarLarge = document.getElementById('profileAvatarLarge');            // Bookmarks Elements
            const bookmarkFloatingBtn = document.getElementById('bookmarkFloatingBtn');
            const bookmarksModal = document.getElementById('bookmarksModal');
            const closeBookmarksModal = document.getElementById('closeBookmarksModal');
            const bookmarksContainer = document.getElementById('bookmarksContainer');            // Social Media Cards
            const youtubeCard = document.getElementById('youtubeCard');
            const instagramCard = document.getElementById('instagramCard');
            const facebookCard = document.getElementById('facebookCard');
            const twitterCard = document.getElementById('twitterCard');
            const telegramCard = document.getElementById('telegramCard');
            const discordCard = document.getElementById('discordCard');            // Social Media Modal
            const socialModal = document.getElementById('socialModal');
            const closeSocialModal = document.getElementById('closeSocialModal');
            const socialModalTitle = document.getElementById('socialModalTitle');
            const socialModalIcon = document.getElementById('socialModalIcon');
            const socialPlatformName = document.getElementById('socialPlatformName');
            const socialDescription = document.getElementById('socialDescription');
            const visitSocialBtn = document.getElementById('visitSocialBtn');            // Social Media Info
            const socialLinks = {
                'youtubeCard': {
                    name: 'YouTube',
                    icon: 'fab fa-youtube',
                    description: 'Watch videos, tutorials, and entertainment',
                    url: SOCIAL_MEDIA_URLS.youtube,
                    color: '#FF0000'
                },
                'instagramCard': {
                    name: 'Instagram',
                    icon: 'fab fa-instagram',
                    description: 'Share photos, stories, and reels',
                    url: SOCIAL_MEDIA_URLS.instagram,
                    color: '#E1306C'
                },
                'facebookCard': {
                    name: 'Facebook',
                    icon: 'fab fa-facebook',
                    description: 'Connect with friends and family',
                    url: SOCIAL_MEDIA_URLS.facebook,
                    color: '#1877F2'
                },
                'twitterCard': {
                    name: 'X (Twitter)',
                    icon: 'fab fa-twitter',
                    description: 'Follow trends and join conversations',
                    url: SOCIAL_MEDIA_URLS.twitter,
                    color: '#1DA1F2'
                },
                'telegramCard': {
                    name: 'Telegram',
                    icon: 'fab fa-telegram',
                    description: 'Secure messaging and channels',
                    url: SOCIAL_MEDIA_URLS.telegram,
                    color: '#0088cc'
                },
                'discordCard': {
                    name: 'Discord',
                    icon: 'fab fa-discord',
                    description: 'Chat, voice, and gaming communities',
                    url: SOCIAL_MEDIA_URLS.discord,
                    color: '#5865F2'
                }
            };            // Temporary storage for new user data
            let tempUserData = null;            // News Modal Functions
            function openNewsModal() {
                newsModal.style.display = 'flex';
            }            function closeNewsModalFunc() {
                newsModal.style.display = 'none';
            }            // Initialize Firebase Auth State Listener
            function initAuthListener() {
                const { onAuthStateChanged } = window.getAuthFunctions;
                
                onAuthStateChanged(window.auth, async (user) => {
                    if (user) {
                        // User is signed in
                        const userProfile = await getUserProfile(user.uid);
                        
                        if (userProfile) {
                            // User has completed profile
                            currentUser = {
                                uid: user.uid,
                                email: user.email,
                                ...userProfile
                            };
                            
                            await updateLastLogin(user.uid);
                            
                            // Show main app
                            showApp();
                            await feedManager.init();
                            updateBookmarkButton();
                            
                            console.log('Smart Feed Manager Status:', feedManager.getStatus());
                        } else {
                            // User needs to complete profile
                            tempUserData = {
                                uid: user.uid,
                                email: user.email
                            };
                            showProfileSetup();
                        }
                    } else {
                        // User is signed out
                        showAuthScreen();
                        feedManager.stopBackgroundCheck();
                    }
                });
            }            // Load avatars for profile setup
            function loadAvatars() {
                avatarGrid.innerHTML = '';
                availableAvatars.forEach((avatarUrl, index) => {
                    const avatarOption = document.createElement('div');
                    avatarOption.className = 'avatar-option';
                    avatarOption.innerHTML = `<img src="${avatarUrl}" alt="Avatar ${index + 1}" loading="lazy" onload="this.classList.add('loaded')">`;
                    
                    avatarOption.addEventListener('click', function() {
                        document.querySelectorAll('.avatar-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        this.classList.add('selected');
                        selectedAvatar = avatarUrl;
                        avatarError.style.display = 'none';
                    });
                    
                    avatarGrid.appendChild(avatarOption);
                });
                
                // Initialize lazy loading for avatars
                setTimeout(lazyLoadImages, 100);
            }            // Update profile story avatar
            function updateProfileAvatar(avatarUrl) {
                // Update profile story card
                const profileCircle = profileStoryAvatar.querySelector('i');
                if (profileCircle) {
                    profileCircle.remove();
                }
                
                const img = document.createElement('img');
                img.src = avatarUrl;
                img.alt = 'Profile';
                img.loading = 'lazy';
                img.onload = function() {
                    this.classList.add('loaded');
                };
                profileStoryAvatar.appendChild(img);
                
                // Update profile modal
                profileAvatarLarge.src = avatarUrl;
                profileAvatarLarge.alt = `${currentUser.username}'s avatar`;
            }            // Open Social Media Modal
            function openSocialMedia(cardId) {
                const socialInfo = socialLinks[cardId];
                if (!socialInfo) return;                // Update modal content
                socialModalTitle.textContent = socialInfo.name;
                socialModalIcon.innerHTML = `<i class="${socialInfo.icon}"></i>`;
                socialModalIcon.style.color = socialInfo.color;
                socialPlatformName.textContent = socialInfo.name;
                socialDescription.textContent = socialInfo.description;                // Set button action
                visitSocialBtn.onclick = function() {
                    if (socialInfo.url && socialInfo.url !== '#') {
                        window.open(socialInfo.url, '_blank');
                    } else {
                        showNotification(`This would open: ${socialInfo.name}`, 'info');
                    }
                    socialModal.style.display = 'none';
                };                // Show modal
                socialModal.style.display = 'flex';
            }            // Show different screens
            function showAuthScreen() {
                authScreen.style.display = 'flex';
                profileSetupScreen.style.display = 'none';
                appInterface.style.display = 'none';
                clearErrors();
                clearForms();
            }            function showProfileSetup() {
                authScreen.style.display = 'none';
                profileSetupScreen.style.display = 'flex';
                appInterface.style.display = 'none';
                clearErrors();
                profileUsername.focus();
            }            function showApp() {
                authScreen.style.display = 'none';
                profileSetupScreen.style.display = 'none';
                appInterface.style.display = 'block';
                
                if (currentUser) {
                    // Update profile modal
                    profileUsernameDisplay.textContent = currentUser.username;
                    profileEmailDisplay.textContent = currentUser.email;
                    
                    // Update "My Profile" story avatar
                    if (currentUser.avatar) {
                        updateProfileAvatar(currentUser.avatar);
                    }
                }
                
                updateBookmarkButton();
                
                // Initialize lazy loading for all images
                setTimeout(lazyLoadImages, 100);
            }            // Setup event listeners
            function setupEventListeners() {
                // News Modal
                if (closeNewsModal) {
                    closeNewsModal.addEventListener('click', closeNewsModalFunc);
                }
                if (newsModal) {
                    newsModal.addEventListener('click', function(e) {
                        if (e.target === newsModal) {
                            closeNewsModalFunc();
                        }
                    });
                }                // News Buttons
                if (desktopNewsBtn) {
                    desktopNewsBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        openNewsModal();
                    });
                }
                
                if (mobileNewsBtn) {
                    mobileNewsBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        openNewsModal();
                    });
                }                // Auth Tab Switching
                authTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabName = this.getAttribute('data-tab');
                        
                        authTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        authForms.forEach(form => {
                            form.classList.remove('active');
                            if (form.id === tabName + 'Form') {
                                form.classList.add('active');
                            }
                        });
                        
                        clearErrors();
                    });
                });                // Auth Link Switching
                authLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        const tabName = this.getAttribute('data-tab');
                        
                        authTabs.forEach(tab => {
                            tab.classList.remove('active');
                            if (tab.getAttribute('data-tab') === tabName) {
                                tab.classList.add('active');
                            }
                        });
                        
                        authForms.forEach(form => {
                            form.classList.remove('active');
                            if (form.id === tabName + 'Form') {
                                form.classList.add('active');
                            }
                        });
                        
                        clearErrors();
                    });
                });                // Login Form Submission
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    clearErrors();
                    
                    const email = loginEmail.value.trim();
                    const password = loginPassword.value.trim();
                    
                    let isValid = true;
                    
                    if (!email) {
                        showError('loginEmailError', 'Email is required');
                        isValid = false;
                    } else if (!isValidEmail(email)) {
                        showError('loginEmailError', 'Please enter a valid email address');
                        isValid = false;
                    }
                    
                    if (!password) {
                        showError('loginPasswordError', 'Password is required');
                        isValid = false;
                    } else if (password.length < 6) {
                        showError('loginPasswordError', 'Password must be at least 6 characters');
                        isValid = false;
                    }
                    
                    if (isValid) {
                        loginBtn.textContent = 'Logging in...';
                        loginBtn.disabled = true;
                        
                        try {
                            const { signInWithEmailAndPassword } = window.getAuthFunctions;
                            await signInWithEmailAndPassword(window.auth, email, password);
                        } catch (error) {
                            console.error('Login error:', error);
                            let errorMessage = 'Login failed. Please try again.';
                            
                            switch (error.code) {
                                case 'auth/user-not-found':
                                    errorMessage = 'No account found with this email.';
                                    break;
                                case 'auth/wrong-password':
                                    errorMessage = 'Incorrect password.';
                                    break;
                                case 'auth/invalid-email':
                                    errorMessage = 'Invalid email address.';
                                    break;
                                case 'auth/user-disabled':
                                    errorMessage = 'This account has been disabled.';
                                    break;
                                case 'auth/too-many-requests':
                                    errorMessage = 'Too many failed attempts. Please try again later.';
                                    break;
                            }
                            
                            showError('loginEmailError', errorMessage);
                            loginBtn.textContent = 'Log In';
                            loginBtn.disabled = false;
                        }
                    }
                });                // Signup Form Submission
                signupForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    clearErrors();
                    
                    const email = signupEmail.value.trim();
                    const password = signupPassword.value.trim();
                    const confirmPassword = signupConfirmPassword.value.trim();
                    
                    let isValid = true;
                    
                    if (!email) {
                        showError('signupEmailError', 'Email is required');
                        isValid = false;
                    } else if (!isValidEmail(email)) {
                        showError('signupEmailError', 'Please enter a valid email address');
                        isValid = false;
                    }
                    
                    if (!password) {
                        showError('signupPasswordError', 'Password is required');
                        isValid = false;
                    } else if (password.length < 6) {
                        showError('signupPasswordError', 'Password must be at least 6 characters');
                        isValid = false;
                    }
                    
                    if (!confirmPassword) {
                        showError('signupConfirmPasswordError', 'Please confirm your password');
                        isValid = false;
                    } else if (password !== confirmPassword) {
                        showError('signupConfirmPasswordError', 'Passwords do not match');
                        isValid = false;
                    }
                    
                    if (isValid) {
                        signupBtn.textContent = 'Creating Account...';
                        signupBtn.disabled = true;
                        
                        try {
                            const { createUserWithEmailAndPassword, sendEmailVerification } = window.getAuthFunctions;
                            const userCredential = await createUserWithEmailAndPassword(window.auth, email, password);
                            
                            await sendEmailVerification(userCredential.user);
                            showNotification('Account created successfully! Please check your email for verification.', 'success', 7000);
                        } catch (error) {
                            console.error('Signup error:', error);
                            let errorMessage = 'Signup failed. Please try again.';
                            
                            switch (error.code) {
                                case 'auth/email-already-in-use':
                                    errorMessage = 'Email already in use.';
                                    break;
                                case 'auth/invalid-email':
                                    errorMessage = 'Invalid email address.';
                                    break;
                                case 'auth/operation-not-allowed':
                                    errorMessage = 'Email/password signup is not enabled.';
                                    break;
                                case 'auth/weak-password':
                                    errorMessage = 'Password is too weak.';
                                    break;
                            }
                            
                            showError('signupEmailError', errorMessage);
                            signupBtn.textContent = 'Sign Up';
                            signupBtn.disabled = false;
                        }
                    }
                });                // Profile Setup Form Submission
                profileSetupForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    clearErrors();
                    
                    const username = profileUsername.value.trim();
                    
                    let isValid = true;
                    
                    if (!username) {
                        showError('profileUsernameError', 'Username is required');
                        isValid = false;
                    } else if (username.length < 3) {
                        showError('profileUsernameError', 'Username must be at least 3 characters');
                        isValid = false;
                    }
                    
                    // Check if username exists
                    if (username && isValid) {
                        const usernameExists = await checkUsernameExists(username);
                        if (usernameExists) {
                            showError('profileUsernameError', 'Username already exists');
                            isValid = false;
                        }
                    }
                    
                    if (!selectedAvatar) {
                        showError('avatarError', 'Please select an avatar for your profile');
                        isValid = false;
                    }
                    
                    if (isValid && tempUserData) {
                        completeProfileBtn.textContent = 'Creating Profile...';
                        completeProfileBtn.disabled = true;
                        
                        try {
                            // Create user profile in Firestore
                            const userProfile = await createUserProfile(tempUserData.uid, {
                                username: username,
                                email: tempUserData.email,
                                avatar: selectedAvatar
                            });
                            
                            if (userProfile) {
                                currentUser = {
                                    uid: tempUserData.uid,
                                    ...userProfile
                                };
                                
                                showNotification('Profile setup complete! Welcome to Silranus!', 'success');
                                showApp();
                                await feedManager.init();
                            } else {
                                showNotification('Failed to create profile. Please try again.', 'error');
                                completeProfileBtn.textContent = 'Complete Profile';
                                completeProfileBtn.disabled = false;
                            }
                        } catch (error) {
                            console.error('Profile setup error:', error);
                            showNotification('Error creating profile. Please try again.', 'error');
                            completeProfileBtn.textContent = 'Complete Profile';
                            completeProfileBtn.disabled = false;
                        }
                    }
                });                // Profile Story Click
                myProfileStory.addEventListener('click', function() {
                    if (currentUser) {
                        profileModal.style.display = 'flex';
                    } else {
                        showNotification('Please login to view your profile', 'warning');
                    }
                });                // Social Media Cards Click Handlers
                youtubeCard.addEventListener('click', () => openSocialMedia('youtubeCard'));
                instagramCard.addEventListener('click', () => openSocialMedia('instagramCard'));
                facebookCard.addEventListener('click', () => openSocialMedia('facebookCard'));
                twitterCard.addEventListener('click', () => openSocialMedia('twitterCard'));
                telegramCard.addEventListener('click', () => openSocialMedia('telegramCard'));
                discordCard.addEventListener('click', () => openSocialMedia('discordCard'));                // Close Profile Modal
                function closeProfileModalFunc() {
                    profileModal.style.display = 'none';
                }                closeProfileModal.addEventListener('click', closeProfileModalFunc);                // Close Social Modal
                closeSocialModal.addEventListener('click', () => socialModal.style.display = 'none');
                socialModal.addEventListener('click', (e) => {
                    if (e.target === socialModal) socialModal.style.display = 'none';
                });                // Logout
                logoutBtn.addEventListener('click', async function() {
                    showConfirm('Are you sure you want to logout?', 
                        async () => {
                            try {
                                const { signOut } = window.getAuthFunctions;
                                await signOut(window.auth);
                                showNotification('Logged out successfully', 'info');
                            } catch (error) {
                                console.error('Logout error:', error);
                                showNotification('Logout failed. Please try again.', 'error');
                            }
                        }
                    );
                });                // Close modal when clicking outside
                profileModal.addEventListener('click', function(e) {
                    if (e.target === profileModal) {
                        closeProfileModalFunc();
                    }
                });                // Category buttons
                categoryBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        categoryBtns.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    });
                });                // Close modals with Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        if (profileModal.style.display === 'flex') {
                            closeProfileModalFunc();
                        }
                        if (newsModal.style.display === 'flex') {
                            closeNewsModalFunc();
                        }
                        if (bookmarksModal.style.display === 'flex') {
                            closeBookmarksModalFunc();
                        }
                        if (socialModal.style.display === 'flex') {
                            socialModal.style.display = 'none';
                        }
                    }
                });                // =============================================
                // UPDATED COMMENT FUNCTIONALITY
                // =============================================
                
                // Comments toggle functionality
                postsContainer.addEventListener('click', function(e) {
                    const commentsToggle = e.target.closest('.comments-header');
                    if (commentsToggle) {
                        const postId = commentsToggle.id.replace('commentsToggle-', '');
                        const commentsList = document.getElementById(`commentsList-${postId}`);
                        const chevron = commentsToggle.querySelector('i');
                        
                        if (commentsList.style.display === 'none') {
                            commentsList.style.display = 'block';
                            chevron.style.transform = 'rotate(180deg)';
                        } else {
                            commentsList.style.display = 'none';
                            chevron.style.transform = 'rotate(0deg)';
                        }
                    }
                });                // Comment character counter functionality
                postsContainer.addEventListener('input', function(e) {
                    const commentInput = e.target.closest('.comment-input');
                    if (commentInput) {
                        const postId = commentInput.id.replace('commentInput-', '');
                        const charCounter = document.getElementById(`commentCharCounter-${postId}`);
                        if (charCounter) {
                            const currentLength = commentInput.value.length;
                            charCounter.textContent = `${currentLength}/150`;
                            
                            if (currentLength > 150) {
                                charCounter.className = 'comment-char-counter error';
                            } else if (currentLength > 120) {
                                charCounter.className = 'comment-char-counter warning';
                            } else {
                                charCounter.className = 'comment-char-counter';
                            }
                            
                            // Enable/disable submit button
                            const submitBtn = document.getElementById(`commentSubmit-${postId}`);
                            if (submitBtn) {
                                submitBtn.disabled = currentLength === 0 || currentLength > 150;
                            }
                        }
                    }
                });                // Submit comment functionality
                postsContainer.addEventListener('click', async function(e) {
                    const commentSubmitBtn = e.target.closest('.comment-submit');
                    if (commentSubmitBtn && currentUser) {
                        const postId = commentSubmitBtn.getAttribute('data-post-id');
                        const commentInput = document.getElementById(`commentInput-${postId}`);
                        const commentText = commentInput.value.trim();
                        
                        if (!commentText) {
                            showNotification('Please enter a comment', 'warning');
                            return;
                        }
                        
                        if (commentText.length > 150) {
                            showNotification(`Comment cannot exceed 150 characters! Current length: ${commentText.length}`, 'error');
                            return;
                        }
                        
                        const originalHTML = commentSubmitBtn.innerHTML;
                        commentSubmitBtn.innerHTML = '<div class="loading"></div>';
                        commentSubmitBtn.disabled = true;
                        
                        try {
                            const commentData = {
                                uid: currentUser.uid,
                                username: currentUser.username,
                                avatar: currentUser.avatar,
                                text: commentText
                            };
                            
                            const comment = await addComment(postId, commentData);
                            
                            if (comment) {
                                commentInput.value = '';
                                const charCounter = document.getElementById(`commentCharCounter-${postId}`);
                                if (charCounter) {
                                    charCounter.textContent = '0/150';
                                    charCounter.className = 'comment-char-counter';
                                }
                                
                                // Clear and focus
                                commentInput.focus();
                                commentSubmitBtn.disabled = true;
                                
                                showNotification('Comment added successfully!', 'success');
                                await feedManager.loadFreshPosts();
                            } else {
                                showNotification('Failed to add comment. Please try again.', 'error');
                                commentSubmitBtn.innerHTML = originalHTML;
                                commentSubmitBtn.disabled = false;
                            }
                        } catch (error) {
                            console.error('Error adding comment:', error);
                            showNotification('Error adding comment. Please try again.', 'error');
                            commentSubmitBtn.innerHTML = originalHTML;
                            commentSubmitBtn.disabled = false;
                        }
                    }
                });                // Comment like functionality
                postsContainer.addEventListener('click', async function(e) {
                    const commentLikeBtn = e.target.closest('.comment-like-btn');
                    if (commentLikeBtn && currentUser) {
                        const postId = commentLikeBtn.getAttribute('data-post-id');
                        const commentId = commentLikeBtn.getAttribute('data-comment-id');
                        const isLiked = commentLikeBtn.classList.contains('liked');
                        
                        const originalHTML = commentLikeBtn.innerHTML;
                        commentLikeBtn.innerHTML = '<div class="loading"></div>';
                        commentLikeBtn.disabled = true;
                        
                        try {
                            const result = await toggleCommentLike(postId, commentId, currentUser.uid);
                            if (result !== null) {
                                // Refresh the post to get updated comments
                                await feedManager.loadFreshPosts();
                            }
                        } catch (error) {
                            console.error('Error toggling comment like:', error);
                            commentLikeBtn.innerHTML = originalHTML;
                            commentLikeBtn.disabled = false;
                        }
                    }
                });                // Comment reply functionality
                postsContainer.addEventListener('click', function(e) {
                    const commentReplyBtn = e.target.closest('.comment-reply-btn');
                    if (commentReplyBtn && currentUser) {
                        const postId = commentReplyBtn.getAttribute('data-post-id');
                        const commentId = commentReplyBtn.getAttribute('data-comment-id');
                        
                        // Focus on comment input and add @username
                        const commentInput = document.getElementById(`commentInput-${postId}`);
                        if (commentInput) {
                            const commentElement = document.querySelector(`.comment[data-comment-id="${commentId}"]`);
                            if (commentElement) {
                                const username = commentElement.querySelector('.comment-username').textContent.trim();
                                commentInput.value = `@${username} `;
                                commentInput.focus();
                                
                                // Update character counter
                                const charCounter = document.getElementById(`commentCharCounter-${postId}`);
                                if (charCounter) {
                                    const currentLength = commentInput.value.length;
                                    charCounter.textContent = `${currentLength}/150`;
                                    
                                    if (currentLength > 150) {
                                        charCounter.className = 'comment-char-counter error';
                                    } else if (currentLength > 120) {
                                        charCounter.className = 'comment-char-counter warning';
                                    } else {
                                        charCounter.className = 'comment-char-counter';
                                    }
                                    
                                    // Enable/disable submit button
                                    const submitBtn = document.getElementById(`commentSubmit-${postId}`);
                                    if (submitBtn) {
                                        submitBtn.disabled = currentLength === 0 || currentLength > 150;
                                    }
                                }
                                
                                showNotification(`Replying to ${username}`, 'info', 2000);
                            }
                        }
                    }
                });                // Like button functionality
                postsContainer.addEventListener('click', async function(e) {
                    const likeBtn = e.target.closest('.like-btn');
                    if (likeBtn && currentUser) {
                        const postId = likeBtn.getAttribute('data-post-id');
                        const isLiked = likeBtn.getAttribute('data-liked') === 'true';
                        
                        const originalHTML = likeBtn.innerHTML;
                        likeBtn.innerHTML = '<div class="loading"></div>';
                        likeBtn.disabled = true;
                        
                        try {
                            const result = await toggleLike(postId, currentUser.uid);
                            if (result !== null) {
                                const updatedPost = await getPostFromFirebase(postId);
                                if (updatedPost) {
                                    if (result) {
                                        likeBtn.classList.add('liked');
                                        likeBtn.setAttribute('data-liked', 'true');
                                        likeBtn.innerHTML = `<i class="fas fa-heart"></i> <span class="like-count">${updatedPost.likes} ${updatedPost.likes === 1 ? 'Like' : 'Likes'}</span>`;
                                        showNotification('Post liked!', 'success', 2000);
                                    } else {
                                        likeBtn.classList.remove('liked');
                                        likeBtn.setAttribute('data-liked', 'false');
                                        likeBtn.innerHTML = `<i class="far fa-heart"></i> <span class="like-count">${updatedPost.likes} ${updatedPost.likes === 1 ? 'Like' : 'Likes'}</span>`;
                                        showNotification('Post unliked', 'info', 2000);
                                    }
                                }
                            }
                        } catch (error) {
                            console.error('Error toggling like:', error);
                            likeBtn.innerHTML = originalHTML;
                            showNotification('Failed to update like. Please try again.', 'error');
                        } finally {
                            likeBtn.disabled = false;
                        }
                    }
                });                // Bookmark button functionality
                postsContainer.addEventListener('click', async function(e) {
                    const bookmarkBtn = e.target.closest('.bookmark-btn');
                    if (bookmarkBtn) {
                        const postId = bookmarkBtn.getAttribute('data-post-id');
                        const isBookmarked = isPostBookmarked(postId);
                        
                        const originalIcon = bookmarkBtn.querySelector('i').className;
                        const originalText = bookmarkBtn.querySelector('span').textContent;
                        
                        if (isBookmarked) {
                            // Remove bookmark
                            bookmarkBtn.classList.add('bookmark-saving');
                            bookmarkBtn.disabled = true;
                            
                            const result = removeBookmark(postId);
                            
                            if (result.success) {
                                bookmarkBtn.classList.remove('bookmarked');
                                bookmarkBtn.querySelector('i').className = 'far fa-bookmark';
                                bookmarkBtn.querySelector('span').textContent = 'Save';
                                showNotification('Post removed from bookmarks', 'info');
                            } else {
                                showNotification(result.message, 'error');
                            }
                            
                            bookmarkBtn.classList.remove('bookmark-saving');
                            bookmarkBtn.disabled = false;
                        } else {
                            // Add bookmark
                            bookmarkBtn.classList.add('bookmark-saving');
                            bookmarkBtn.disabled = true;
                            
                            const result = await addBookmark(postId);
                            
                            if (result.success) {
                                bookmarkBtn.classList.add('bookmarked');
                                bookmarkBtn.classList.add('bookmark-saved');
                                bookmarkBtn.querySelector('i').className = 'fas fa-bookmark';
                                bookmarkBtn.querySelector('span').textContent = 'Saved';
                                
                                setTimeout(() => {
                                    bookmarkBtn.classList.remove('bookmark-saved');
                                }, 500);
                                
                                showNotification(result.message, 'success');
                            } else {
                                showNotification(result.message, 'error');
                            }
                            
                            bookmarkBtn.classList.remove('bookmark-saving');
                            bookmarkBtn.disabled = false;
                        }
                    }
                });                // Delete comment functionality
                postsContainer.addEventListener('click', async function(e) {
                    const deleteBtn = e.target.closest('.comment-delete-btn');
                    if (deleteBtn && currentUser) {
                        const postId = deleteBtn.getAttribute('data-post-id');
                        const commentId = deleteBtn.getAttribute('data-comment-id');
                        
                        showConfirm('Are you sure you want to delete this comment?', 
                            async () => {
                                const originalHTML = deleteBtn.innerHTML;
                                deleteBtn.innerHTML = '<div class="loading"></div>';
                                deleteBtn.disabled = true;
                                
                                try {
                                    const success = await deleteComment(postId, commentId);
                                    
                                    if (success) {
                                        showNotification('Comment deleted successfully!', 'success');
                                        await feedManager.loadFreshPosts();
                                    } else {
                                        showNotification('Failed to delete comment. Please try again.', 'error');
                                    }
                                } catch (error) {
                                    console.error('Error deleting comment:', error);
                                    showNotification('Error deleting comment. Please try again.', 'error');
                                } finally {
                                    deleteBtn.innerHTML = originalHTML;
                                    deleteBtn.disabled = false;
                                }
                            }
                        );
                    }
                });                // Bookmarks functionality
                function openBookmarksModal() {
                    loadAndDisplayBookmarks();
                    bookmarksModal.style.display = 'flex';
                    setTimeout(lazyLoadImages, 100);
                }                function closeBookmarksModalFunc() {
                    bookmarksModal.style.display = 'none';
                }                // Open bookmarks modal
                bookmarkFloatingBtn.addEventListener('click', openBookmarksModal);                // Close bookmarks modal
                closeBookmarksModal.addEventListener('click', closeBookmarksModalFunc);                // Close bookmarks modal when clicking outside
                bookmarksModal.addEventListener('click', function(e) {
                    if (e.target === bookmarksModal) {
                        closeBookmarksModalFunc();
                    }
                });                // Remove bookmark from bookmarks modal
                bookmarksContainer.addEventListener('click', function(e) {
                    const removeBtn = e.target.closest('.remove-bookmark-btn');
                    if (removeBtn) {
                        const postId = removeBtn.getAttribute('data-post-id');
                        
                        showConfirm('Remove this post from bookmarks?', 
                            () => {
                                removeBookmark(postId);
                                loadAndDisplayBookmarks();
                                
                                const postBookmarkBtn = document.querySelector(`.bookmark-btn[data-post-id="${postId}"]`);
                                if (postBookmarkBtn) {
                                    postBookmarkBtn.classList.remove('bookmarked');
                                    postBookmarkBtn.querySelector('i').className = 'far fa-bookmark';
                                    postBookmarkBtn.querySelector('span').textContent = 'Save';
                                }
                                
                                showNotification('Bookmark removed', 'info');
                            }
                        );
                    }
                });
            }            // Helper Functions
            function showError(elementId, message) {
                const errorElement = document.getElementById(elementId);
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                }
            }            function clearErrors() {
                errorMessages.forEach(error => {
                    error.style.display = 'none';
                });
            }            function clearForms() {
                loginForm.reset();
                signupForm.reset();
                profileSetupForm.reset();
                selectedAvatar = null;
                document.querySelectorAll('.avatar-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                avatarError.style.display = 'none';
                
                loginBtn.textContent = 'Log In';
                loginBtn.disabled = false;
                signupBtn.textContent = 'Sign Up';
                signupBtn.disabled = false;
                completeProfileBtn.textContent = 'Complete Profile';
                completeProfileBtn.disabled = false;
            }            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }            // Initialize the application
            function initApp() {
                loadAvatars();
                initAuthListener();
                setupEventListeners();
                
                console.log('Silranus App Initialized');
                console.log('Smart Feed System: Ready');
                console.log('News Feature: Coming Soon');
                console.log('User Posting: Disabled');
                console.log('Like/Comment System: Enabled');
                console.log('Notification System: Ready');
            }            initApp();
        });
    </script>
</body>
</html>
